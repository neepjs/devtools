/*!
 * Neep v0.1.0-alpha.6
 * (c) 2019-2020 Fierflame
 * @license MIT
 */
const e="undefined",t="production",n=!0;var r=Object.freeze({__proto__:null,version:"undefined",mode:t,isProduction:!0});function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class o extends Error{constructor(e,t=""){super(t?`[${t}] ${e}`:e),i(this,"tag",void 0),this.tag=t}}let s,c,d,l,a,u,h;function f(e){!function(e,t,n){if(!e)throw new o(t,n)}(h,"The basic renderer is not installed","install"),h(e)}const p=Object.create(null);function _(e=""){return"object"==typeof e?e:p[e]||p.default}function y(e){e&&(p[e.type]=e,h||(p.default||(p.default=e),!h&&e.nextFrame&&(p.default=e,h=e.nextFrame)))}function v(e){var t;(t=e.monitorable)&&(s=t,c=s.value,d=s.computed,l=s.isValue,a=s.encase,u=s.recover),function({render:e,renders:t}){if(y(e),Array.isArray(t))for(const e of t)y(e)}(e)}const g="Neep:ScopeSlot",m="Neep:SlotRender",w="Neep:Slot",b="Neep:Value",R="Neep:Container",x="Neep:Deliver",A="template",k=A;var D=Object.freeze({__proto__:null,ScopeSlot:g,SlotRender:m,Slot:w,Value:b,Container:R,Deliver:x,Template:A,Fragment:k});let $;function C(e,t){const n=$;$=t;try{$.$_valueIndex=0;const t=e();if($.$_valueIndex!==$.$_values.length)throw new o("Inconsistent number of useValue executions","life");return t}finally{$=n}}function S(e,t=!1){if(!$)throw new o(`Function \`${e}\` can only be called within a cycle.`,"life");if(!t)return $;if(!$.created)return $;throw new o(`Function \`${e}\` can only be called at initialization time.`,"life")}const N=[];function j(e,t){for(const n of N)n(e,t);return e}function O(e){N.push(s.safeify(e))}const H=Object.create(null);function P(e,t,n){let r=(null==n?void 0:n.$_hooks)||H;if(!r)return()=>{};t=s.safeify(t);let i=r[e];return i||(i=new Set,r[e]=i),i.add(t),()=>i.delete(t)}function E(e,t){if(t){for(const n of t.$_hooks[e]||[])n(t);for(const n of H[e]||[])n(t)}}function T(e,t){const n=S("watch");if("function"!=typeof e)return()=>{};const r=l(e)?e.watch(t):d(e).watch((e,n)=>t(e(),n));return P("beforeDestroy",()=>r(),n),r}function z(e,t="useValue"){const n=S(t),r=n.$_valueIndex++,i=n.$_values;if(!n.created){i[r]=void 0;const t="function"==typeof e?e():c(void 0);return i[r]=t}if(r>=i.length)throw new o("Inconsistent number of useValue executions","life");return i[r]}function I(e,t,n){const r=S("setHook");if(!n||!r.created)return P(e,()=>t(),r)}function M(e,t,n,r){"string"==typeof t&&["$","_"].includes(t[0])||(l(n)&&r?Reflect.defineProperty(e,t,{get:()=>n(),set(e){n(e)},configurable:!0,enumerable:!0}):"function"==typeof n&&r?Reflect.defineProperty(e,t,{get:n,set:"function"==typeof r?r:void 0,configurable:!0,enumerable:!0}):Reflect.defineProperty(e,t,{get:()=>n,configurable:!0,enumerable:!0}))}function V(e,t,n){M(S("expose",!0).exposed,e,t,n)}function q(e,t,n){M(S("deliver",!0).delivered,e,t,n)}var F=Object.freeze({__proto__:null,watch:T,useValue:z,hook:I,setValue:M,expose:V,deliver:q});const K=Symbol.for("isNeepElement"),B=Symbol.for("type"),U=Symbol.for("name"),Z=Symbol.for("render");function G(e){return!!e&&("object"==typeof e&&!0===e[K])}function J(e,t,...n){t=t?{...t}:{};const r={[K]:!0,tag:e,children:[]};if("key"in t&&(r.key=t.key),"slot"in t&&(r.slot=t.slot),"function"==typeof t.ref&&(r.ref=t.ref),e===b)return r.value=t.value,r;if(r.children=n,e===A)return r;if(e===m)return r.render=t.render,r;if(e===g||e===w){const{render:n,argv:i,args:o,name:s}=t;if(r.render=n,r.args=i&&[i]||Array.isArray(o)&&o.length&&o||[{}],e===g)return r.props={name:s},r}r.on={},r.props={};for(let e in t){const n=/^(::|@|on:)([a-zA-Z0-9].*)$/.exec(e);n?r.on[n[2]]=t[e]:/^n([:-])([a-zA-Z0-9]+(?:\.[a-zA-Z0-9]+)*)$/i.exec(e)||(r.props[e]=t[e])}return r}function L(e,t={}){if(Array.isArray(e)){const n=[];for(let r of e)n.push(L(r,t));return[].concat(...n)}if(!G(e))return[e];let{tag:n}=e;if(!n)return[];if([A,g].includes(n))return L(e.children,t);if("function"!=typeof n)return[e];if("simple"!==n[B])return[e];const{simple:r}=t;if(!r)return[e];if(Array.isArray(r)){if(r.includes(n))return[e]}else if("function"==typeof r&&!r(n))return[e];return L(e.children,t)}var Q=Object.freeze({__proto__:null,isElement:G,createElement:J,elements:L});function W(e,t=""){}var X=Object.freeze({__proto__:null,label:W});const Y={...D,...F,...Q,...X,...r,get value(){return c},get computed(){return d},get isValue(){return l},get encase(){return a},get recover(){return u}};function ee(e,t){Reflect.defineProperty(Y,e,{value:t,enumerable:!0,configurable:!0})}function te(e,t){Reflect.defineProperty(Y,e,{get:t,enumerable:!0,configurable:!0})}function ne(e,t){return{...e,id:0}}function*re(e){if(Array.isArray(e))for(const t of e)yield*re(t);else yield e}let ie;function oe(e){ie=e}function se(e,t,n){"function"==typeof e&&t&&(ie?ie.push(()=>e(t,n)):e(t,n))}function ce(e){if(Array.isArray(e))return ce(e[e.length-1]);const{component:t,children:n,node:r}=e;return r||ce(t?t.tree:n)}function de(e){if(Array.isArray(e))return de(e[0]);const{component:t,children:n,node:r}=e;return r||de(t?t.tree:n[0])}function*le(e){if(Array.isArray(e)){for(const t of e)yield*le(t);return}const{children:t,node:n,component:r}=e;n?yield n:r?yield*le(r.tree):yield*le(t)}function ae(e,t){if(Array.isArray(t))return void t.forEach(t=>ae(e,t));const{component:n,children:r,node:i,ref:o}=t;return i?(se(o,i,!0),void e.remove(i)):n?(se(o,n.exposed,!0),void n.unmount()):void ae(e,r)}function ue(e,t,n){const r=de(n);if(!r)return t;const i=e.parent(r);if(!i)return t;for(const n of le(t))e.insert(i,n,r);return ae(e,n),t}function he(e,t,n){if(!t.length){return[ue(e,ge(e,{tag:null,children:[]}),n)]}Array.isArray(n)||(n=[n]);const r=[],i=[...n],o=new Map;for(const n of t){const t=i.findIndex(e=>e.tag===n.tag&&e.key===n.key);if(t>=0){const s=i[t],c=pe(e,n,s);o.set(s,c),r.push(c),i.splice(t,1)}else{const t=ge(e,n);r.push(t)}}if(!o.size)return ue(e,r,i);ae(e,i);const s=ce((n=n.filter(e=>o.has(e)))[n.length-1]),c=e.parent(s);if(!c)return r;let d=e.next(s);for(let t=r.length-1;t>=0;t--){const i=r[t],s=n.findIndex(e=>o.get(e)===i);if(s>=0)for(const e of n.splice(s))o.delete(e);else for(const t of le(i))e.insert(c,t,d);d=de(i)||d}return r}function fe(e,t,n){let r=0,i=Math.min(t.length,t.length||1);const o=[];for(;r<i;r++){const i=t[r];Array.isArray(i)?o.push(he(e,i,n[r])):o.push(pe(e,i,n[r]))}if(i=Math.max(t.length,n.length),n.length>i)for(;r<i;r++)ae(e,n[r]);if(t.length>i){const n=ce(o[o.length-1]),s=e.parent(n),c=e.next(n);for(;r<i;r++){const n=t[r],i=Array.isArray(n)?ve(e,n):ge(e,n);if(o.push(i),s)for(const t of le(i))e.insert(s,t,c)}}return o}function pe(e,t,n){if(Array.isArray(n)){const r=n.findIndex(e=>e.tag===t.tag&&e.component===t.component);if(r<0)return ue(e,ge(e,t),n);const i=n;[n]=n.splice(r,1),ae(e,i)}const{tag:r,component:i}=t,o=t.ref!==n.ref&&t.ref||void 0;if(r!==n.tag||i!==n.component)return ue(e,ge(e,t),n);if(!r)return n;if("string"!=typeof r||r===R)return i?(se(o,i.exposed),ne({...t,node:void 0,component:i,children:[]},n.id)):ne({...t,node:void 0,component:void 0,children:me(e,t.children,n.children)},n.id);if(r===b){let r=t.value;return l(r)&&(r=r()),n.value===r?(se(o,n.node),ne({...n,...t,value:r,children:[]},n.id)):ue(e,_e(e,t,r),n)}if(r===A||"Neep:"===r.substr(0,5))return ne({...t,node:void 0,component:void 0,children:fe(e,t.children,n.children)},n.id);const{node:s}=n;if(e.update(s,t.props||{},l),se(o,s),!t.children.length&&!n.children.length)return ne({...n,...t,children:[]},n.id);if(!t.children.length&&n.children.length&&ae(e,n.children),t.children.length&&!n.children.length){const r=ye(e,t.children);for(const t of le(r))e.insert(s,t);return ne({...n,...t,children:r},n.id)}return ne({...n,...t,children:fe(e,t.children,n.children)},n.id)}function _e(e,t,n){let{ref:r}=t;if(e.isNode(n))return se(r,n),ne({...t,value:n,node:n,children:[],component:void 0});const i=typeof n;let o;return"bigint"===i||"boolean"===i||"number"===i||"string"===i||"symbol"===i||n instanceof RegExp?o=e.text(String(n)):n instanceof Date?o=e.text(n.toISOString()):"object"===i&&n&&(o=e.text(String(n))),o||(o=e.placeholder()),se(r,o),ne({...t,value:n,node:o,component:void 0,children:[]})}function ye(e,t){return t.length?t.map(t=>Array.isArray(t)?ve(e,t):ge(e,t)):[ne({tag:null,node:e.placeholder(),component:void 0,children:[]})]}function ve(e,t){return t.length?t.map(t=>ge(e,t)):[ne({tag:null,node:e.placeholder(),component:void 0,children:[]})]}function ge(e,t){const{tag:n,ref:r,component:i}=t;if(!n){const t=e.placeholder();return se(r,t),ne({tag:null,node:t,component:void 0,children:[]})}if("string"!=typeof n||n===R)return i?(i.mount(),se(r,i.exposed),ne({...t,node:void 0,component:i,children:[]})):ne({...t,node:void 0,component:void 0,children:me(e,t.children)});if(n===b)return _e(e,t,t.value);if(n===A||"Neep:"===n.substr(0,5))return ne({...t,node:void 0,component:void 0,children:ye(e,t.children)});const o=e.create(n,t.props||{},l);se(r,o);let s=[];if(t.children){s=ye(e,t.children);for(const t of le(s))e.insert(o,t)}return ne({...t,node:o,component:void 0,children:s})}function me(e,t,n){return n?fe(e,t,n):ye(e,t)}function we(e,t,n,r=!1){const i=[];for(const o of t){if(Array.isArray(o)){const t=Object.create(null);i.push(we(e,o,t,r));for(const e of Reflect.ownKeys(t))e in n?n[e].push(t[e]):n[e]=[t[e]];continue}if(r){if(e.isNode(o)){i.push(o);continue}if(!G(o)){i.push(o);continue}if(o.tag!==m){i.push(o);continue}}const t=G(o)&&o.slot||"default",s=G(o)?{...o,slot:void 0,props:{...o.props,slot:void 0}}:o;t in n?n[t].push(s):n[t]=[s]}return i}function be(e,...t){return e.map(e=>Array.isArray(e)?be(e,...t):G(e)?e.tag!==m?{...e,slot:void 0}:"function"==typeof e.render?e.render(...t):e.children:e)}function Re(e,t){const n=(...e)=>({[K]:!0,tag:g,children:be(t,...e),inserted:!0,label:void 0});return n.children=t,n}function xe(e,t=Object.create(null)){for(const n of Reflect.ownKeys(t))n in e||delete t[n];for(const n of Reflect.ownKeys(e))t[n]=Re(0,e[n]);return t}function Ae(e,t,n={},r=!1){const i=new Set(Reflect.ownKeys(t));for(const t of Reflect.ownKeys(e))i.has(t)||delete e[t];if(!r){for(const n of i)e[n]=t[n];return e}for(const r of i){const i=t[r];r in n&&n[r]===i||(l(i)?Reflect.defineProperty(e,r,{configurable:!0,enumerable:!0,get:()=>i(),set(e){i(e)}}):Reflect.defineProperty(e,r,{configurable:!0,enumerable:!0,value:i}))}return e}function ke(e,t,n,r,i=!1){if(Array.isArray(n))return n.map(n=>ke(e,t,n,r,i));if(!G(n))return n;let{tag:o,inserted:s,args:c=[{}]}=n;if(o===x){const s={...n.props};delete s.ref,delete s.slot,delete s.key;const c=Object.create(t);return Ae(c,s||{},{},!0),{...n,tag:o,$__neep__delivered:c,children:n.children.map(t=>ke(e,c,t,r,i))}}const d=n.children.map(n=>ke(e,t,n,r,i));return"function"==typeof o?"simple"===o[B]?function(e,t,n,r,i){const{iRender:o}=e.container,s=Object.create(null);we(o,i,s);const c=xe(s),d=j({slots:c,created:!1,parent:e.exposed,delivered:t,children:new Set,childNodes:i,refresh(t){e.refresh(t)}}),l=r({...n.props},d,Y),a=ke(e,t,De(o,l,d,r[Z]),c);return{...n,children:Array.isArray(a)?a:[a],label:void 0}}(e,t,n,o,d):{...n,$__neep__delivered:t,children:d,tag:o}:(o===w&&(o=i?"slot":g),o!==g||s?{...n,children:d,tag:o}:function(e,t,n,r=[{}]){var i;const o=t[(null===(i=e.props)||void 0===i?void 0:i.name)||"default"];if("function"==typeof o)return{...e,...o(...r)};const{render:s}=e;return{...e,tag:g,label:void 0,children:"function"!=typeof s?n:s(...r)}}(n,r,d,c))}function De(e,t,n,r){return Array.isArray(t)?t:G(t)?[t]:null==t?[{[K]:!0,tag:null,children:[]}]:(!e.isNode(t)&&"object"==typeof t&&r&&(t=r(t,n,Y)),G(t)?[t]:null==t?[{[K]:!0,tag:null,children:[]}]:[{[K]:!0,tag:b,value:t,children:[]}])}function $e(e,t){return ke(e,e.delivered,De(e.iRender,t,e.context,e.component[Z]),e.context.slots,Boolean(e.native))}let Ce=0;const Se=new Set;function Ne(e){return!(Ce<=0)&&(Se.add(e),!0)}function je(){if(Ce>0)return;const e=[...Se];Se.clear(),e.forEach(e=>e.refresh())}function Oe(e,t){if(t)return async function(e){try{return Ce++,await e()}finally{Ce--,je()}}(e);try{return Ce++,e()}finally{Ce--,je()}}let He;function Pe(e){He=e}function Ee(e){He?He.push(e):e()}class Te{constructor(e,t,n=(null==t?void 0:t.delivered)||Object.create(null),r){i(this,"iRender",void 0),i(this,"parentDelivered",void 0),i(this,"delivered",void 0),i(this,"exposed",function(e){const t={$parent:{configurable:!0,get:()=>{var t;return null===(t=e.parent)||void 0===t?void 0:t.exposed}},$component:{configurable:!0,value:null},$isContainer:{configurable:!0,value:!1},$created:{configurable:!0,get:()=>e.created},$destroyed:{configurable:!0,get:()=>e.destroyed},$mounted:{configurable:!0,get:()=>e.mounted},$unmounted:{configurable:!0,get:()=>e.unmounted}};return Object.create(null,t)}(this)),i(this,"entity",function(e){const t={exposed:{configurable:!0,get:()=>e.exposed},delivered:{configurable:!0,get:()=>e.delivered},parent:{configurable:!0,get:()=>{var t;return null===(t=e.parent)||void 0===t?void 0:t.entity}},component:{configurable:!0,value:null},isContainer:{configurable:!0,value:!1},created:{configurable:!0,get:()=>e.created},destroyed:{configurable:!0,get:()=>e.destroyed},mounted:{configurable:!0,get:()=>e.mounted},unmounted:{configurable:!0,get:()=>e.unmounted},$_hooks:{configurable:!0,value:Object.create(null)},$_valueIndex:{configurable:!0,value:0,writable:!0},$_values:{configurable:!0,value:[]},callHook:{configurable:!0,value(e){E(e,n)}},setHook:{configurable:!0,value:(e,t)=>P(e,t,n)},refresh:{configurable:!0,value:e.refresh.bind(e)}},n=Object.create(null,t);return n}(this)),i(this,"parent",void 0),i(this,"native",void 0),i(this,"created",!1),i(this,"destroyed",!1),i(this,"mounted",!1),i(this,"unmounted",!1),i(this,"children",new Set),i(this,"tree",[]),i(this,"container",void 0),i(this,"_render",()=>[]),i(this,"_needRefresh",!1),i(this,"_delayedRefresh",0),i(this,"_refreshing",!1),i(this,"_nodes",[]),i(this,"childNodes",[]),i(this,"__executed_destroy",!1),i(this,"__executed_mount",!1),i(this,"__executed_mounted",!1),i(this,"_cancelDrawMonitor",void 0),this.iRender=e,this.parentDelivered=n,this.delivered=Object.create(n),t&&(this.parent=t),this.container=r||this}get canRefresh(){return!Ne(this)&&!this._delayedRefresh}get needRefresh(){if(Ne(this))return!1;if(this._delayedRefresh)return!1;const e=this._needRefresh;return this._needRefresh=!1,e}requestDraw(){}async asyncRefresh(e){try{return this._delayedRefresh++,await e()}finally{this._delayedRefresh--,this.refresh()}}refresh(e,t){if("function"==typeof e){if(t)return this.asyncRefresh(e);try{return this._delayedRefresh++,e()}finally{this._delayedRefresh--,this._delayedRefresh<=0&&this.refresh()}}if(this.destroyed)return;if(this._needRefresh=!0,!this.created)return;if(this._refreshing)return;let n;for(this._refreshing=!0;this.needRefresh;)if(n=this._render(),this.destroyed)return;this._refreshing=!1,this.canRefresh&&n&&(this._nodes=Ue(this,n,this._nodes),this.mounted&&(this.destroyed||this.unmounted||this.requestDraw()))}callHook(e){E(e,this.entity)}_update(e,t){this.childNodes=t}update(e,t){this._update(e,t)}_destroy(){}destroy(){this.__executed_destroy||(this.__executed_destroy=!0,this.callHook("beforeDestroy"),this._destroy(),this.callHook("destroyed"),this.destroyed=!0)}_mount(){}mount(){if(this.__executed_destroy)return;if(this.__executed_mount)return;this.__executed_mount=!0,this.callHook("beforeMount");const e=s.exec(()=>{this._mount(),this.mounted=!0},e=>e&&this.requestDraw(),{postpone:!0});this._cancelDrawMonitor=e.stop,Ee(()=>this.callHook("mounted"))}_unmount(){}unmount(){this.mounted&&(this.__executed_mounted||(this.__executed_mounted=!0,this.callHook("beforeUnmount"),this._unmount(),this.callHook("unmounted"),this.unmounted=!0))}_draw(){}draw(){var e;if(this.__executed_destroy)return;null===(e=this._cancelDrawMonitor)||void 0===e||e.call(this),this.callHook("beforeUpdate");const t=s.exec(()=>this._draw(),e=>e&&this.requestDraw(),{postpone:!0});this._cancelDrawMonitor=t.stop,Ee(()=>this.callHook("updated"))}}function ze(e,t,n){Ae(e.props,t);const r=Object.create(null),{native:i,iRender:o}=e,s=we(o,n,r,Boolean(i));xe(r,e.slots),i&&(e.nativeNodes=Ue(e,s,e.nativeNodes),e.mounted&&e.requestDraw())}class Ie extends Te{constructor(e,t,n,r,o){var c,d;super(r.iRender,r,o,r.container),i(this,"component",void 0),i(this,"props",s.encase(Object.create(null))),i(this,"slots",s.encase(Object.create(null))),i(this,"_stopRender",void 0),i(this,"nativeNodes",void 0),i(this,"shadowTree",[]),i(this,"nativeTree",[]),i(this,"_shadow",void 0),i(this,"context",void 0),i(this,"parent",void 0),this.component=e,Reflect.defineProperty(this.exposed,"$component",{value:e,enumerable:!0,configurable:!0}),[this.native,this._shadow]="native"===e[B]&&(null===(c=(d=this.iRender).component)||void 0===c?void 0:c.call(d))||[],this.parent=r,r.children.add(this.exposed);const l=j({slots:(a=this).slots,get created(){return a.created},get parent(){return a.parent.exposed},get delivered(){return a.parentDelivered},get children(){return a.children},get childNodes(){return a.childNodes},refresh(e){a.refresh(e)}},a.exposed);var a;this.context=l,this.callHook("beforeCreate"),this.childNodes=n,ze(this,t,n);const{render:u,nodes:h,stopRender:f}=function(e){const{component:t,props:n,context:r,entity:i}=e,o=t=>t&&e.refresh(),c=s.exec(()=>C(()=>t(n,r,Y),i),o,{resultOnly:!0,postpone:!0});if("function"==typeof c){const t=s.createExecutable(()=>$e(e,c()),o);return{nodes:t(),render:t,stopRender:()=>t.stop()}}const d=s.createExecutable(()=>$e(e,C(()=>t(n,r,Y),i)),o,{postpone:!0});return{nodes:s.exec(()=>$e(e,c),o,{resultOnly:!0,postpone:!0}),render:d,stopRender:()=>d.stop()}}(this);this._render=u,this._stopRender=f,this._nodes=Ue(this,h),this.callHook("created"),this.created=!0,this._needRefresh&&this.refresh()}_update(e,t){this.destroyed||(this.childNodes=t,ze(this,e,t))}_destroy(){this._stopRender&&this._stopRender(),this.parent.children.delete(this.exposed),Ve(this._nodes)}requestDraw(){this.container.markDraw(this)}_draw(){const{nativeNodes:e,iRender:t,_shadow:n,native:r}=this;r&&e&&n?(this.shadowTree=me(t,this._nodes,this.shadowTree),this.nativeTree=me(t,e,this.nativeTree)):this.tree=me(t,this._nodes,this.tree)}_mount(){const{nativeNodes:e,iRender:t,_shadow:n,native:r,_nodes:i}=this;if(r&&e&&n){this.tree=me(t,Ue(this,r)),this.shadowTree=me(t,i);for(const e of le(this.shadowTree))t.insert(n,e);this.nativeTree=me(t,e);for(const e of le(this.nativeTree))t.insert(r,e)}else this.tree=me(t,i)}_unmount(){const{iRender:e,nativeTree:t}=this;ae(e,this.tree),t&&ae(e,t)}}function Me(e){return!1===e||null==e?null:G(e)?e:{[K]:!0,tag:b,key:e,value:e,children:[]}}function Ve(e){if(Array.isArray(e))return void e.forEach(e=>Ve(e));const{component:t}=e;t&&t.destroy()}function qe(e,t){if(!t)return{tag:null,children:[]};const{tag:n}=t;if(!n)return{tag:null,children:[]};if("string"!=typeof n)return"simple"===n[B]?{...t,children:Ue(e,t.children),component:void 0}:{...t,children:[],component:new Ie(n,t.props||{},t.children,e,t.$__neep__delivered)};if(n===R){var r;const n=null==t||null===(r=t.props)||void 0===r?void 0:r.type,i=n?_(n):e.iRender;return{...t,children:[],component:new Je(i,t.props||{},t.children,e,t.$__neep__delivered)}}return n===b?{...t,children:[]}:(n===A||n.substr(0,5),{...t,children:Ue(e,t.children)})}function Fe(e,t,n){Array.isArray(n)||(n=[n]);const r=[];for(const i of re(t)){const t=Me(i);if(!t)continue;const o=n.findIndex(e=>e.tag===t.tag&&e.key===t.key);o>=0?(r.push(Ke(e,t,n[o])),n.splice(o,1)):r.push(qe(e,t))}return Ve(n),r}function Ke(e,t,n){if(!n)return qe(e,t);if(!t)return Ve(n),{tag:null,children:[]};if(Array.isArray(n)){if(!n.length)return qe(e,t);const r=n.findIndex(e=>e.tag===t.tag);if(r<0)return Ve(n),qe(e,t);const i=n;[n]=n.splice(r,1),Ve(i)}const{tag:r}=t;if(r!==n.tag)return Ve(n),qe(e,t);if(!r)return{tag:null,children:[]};if("string"!=typeof r){if("simple"===r[B])return{...t,children:Ue(e,t.children,n.children),component:void 0};const{component:i}=n;return i?(i.update(t.props||{},t.children),{...t,children:[],component:i}):qe(e,t)}if(r===R){var i;const{component:r}=n;if(!r)return qe(e,t);const o=null==t||null===(i=t.props)||void 0===i?void 0:i.type;return(o?_(o):e.iRender)!==r.iRender?qe(e,t):(r.update(t.props||{},t.children),{...t,children:[],component:r})}if(r===b)return{...t,children:[]};if(r===A||"Neep:"===r.substr(0,5)){let i;if(x===r){const e={...t.props};delete e.ref,delete e.slot,delete e.key,i=Ae(n.$__neep__delivered,e,n.props,!0)}return{...t,$__neep__delivered:i,children:Ue(e,t.children,n.children)}}return{...t,children:Ue(e,t.children,n.children)}}function*Be(e,t,n){let r=0,i=Math.min(t.length,t.length);for(;r<i;r++){const i=t[r];Array.isArray(i)?yield Fe(e,i,n[r]):yield Ke(e,Me(i),n[r])}if(i=Math.max(t.length,t.length),n.length>i)for(;r<i;r++)Ve(n[r]);if(t.length>i)for(;r<i;r++){const n=Me(t[r]);Array.isArray(n)?yield[...re(n)].map(t=>qe(e,t)):yield qe(e,n)}}function Ue(e,t,n){return Array.isArray(t)||(t=[t]),n?[...Be(e,t,n)]:function(e,t){return t.length?t.map(t=>Array.isArray(t)?[...re(t)].map(t=>qe(e,Me(t))):qe(e,Me(t))):[]}(e,t)}let Ze=new Set,Ge=!1;class Je extends Te{constructor(e,t,n,r,o){super(e,r,o),i(this,"props",void 0),i(this,"content",[]),i(this,"_node",null),i(this,"_container",null),i(this,"rootContainer",this),i(this,"_drawChildren",!1),i(this,"_drawContainer",!1),i(this,"_awaitDraw",new Set),i(this,"_needDraw",!1),i(this,"_containers",new Set),this.props=t,this.parent=r,r&&(this.rootContainer=r.container.rootContainer),this.callHook("beforeCreate"),this._render=()=>n,this._nodes=Ue(this,n),this.callHook("created"),this.created=!0}setChildren(e){this.destroyed||(this.childNodes=e,this._render=()=>e,this._drawChildren=!0,this.refresh())}setProps(e){this.destroyed||(this.props=e,this._drawContainer=!0,this.refresh())}update(e,t){this.refresh(()=>{this.setProps(e),this.setChildren(t)})}requestDraw(){this.markDraw(this)}_mount(){const{props:e,parent:t,iRender:n}=this,r=me(this.container.iRender,this._nodes);this.content=r;const[i,o]=n.mount(e,l,null==t?void 0:t.iRender);for(const e of le(r))n.insert(i,e);this.tree=[ne({tag:b,component:void 0,node:o,value:o,children:[]})],this._node=o,this._container=i}_destroy(){Ve(this.content)}_unmount(){const{parent:e,iRender:t}=this;e&&ae(e.iRender,this.tree),t.unmount(this._container,this._node,Boolean(e)),ae(this.iRender,this.content)}_draw(){const{_drawChildren:e,_drawContainer:t}=this;var n;(this._drawContainer=!1,t)&&this.iRender.drawContainer(this._container,this._node,this.props,l,null===(n=this.parent)||void 0===n?void 0:n.iRender);this.parent&&this.parent.iRender!==this.iRender||(this._drawChildren=!1,e&&(this.content=me(this.iRender,this._nodes,this.content)))}_drawSelf(){const{_drawChildren:e,_drawContainer:t}=this;var n;(this._needDraw=!1,this._drawChildren=!1,this._drawContainer=!1,t)&&this.iRender.drawContainer(this._container,this._node,this.props,l,null===(n=this.parent)||void 0===n?void 0:n.iRender,!0);e&&(this.content=me(this.iRender,this._nodes,this.content))}drawSelf(){this.mounted&&(this.destroyed||(this.callHook("beforeUpdate"),s.exec(()=>this._drawSelf(),e=>e&&this.markDraw(this),{postpone:!0}),Ee(()=>this.callHook("updated"))))}markDraw(e,t=!1){var n;(null===(n=this.parent)||void 0===n?void 0:n.iRender)!==this.iRender?(e===this&&this.parent?(this.parent.container.markDraw(this,t),this._needDraw=!t):t?this._awaitDraw.delete(e):this._awaitDraw.add(e),this.rootContainer.markDrawContainer(this,!this._needDraw&&!this._awaitDraw.size||this.destroyed)):this.parent.container.markDraw(e,t)}drawContainer(){const{_node:e,_container:t,_awaitDraw:n}=this;if(!e||!t)return;this.callHook("beforeDraw");const r=this._needDraw;this._needDraw=!1;const i=[...n];n.clear(),r&&this.drawSelf(),i.map(e=>e.draw()),this.iRender.draw(t,e),Ee(()=>this.callHook("drawn"))}markDrawContainer(e,t=!1){var n;t?this._containers.delete(e):this._containers.add(e),n=this,Ze.add(n),Ge||(Ge=!0,f(()=>{Ge=!1;const e=[...Ze];Ze.clear(),e.map(e=>e.drawAll())}))}drawAll(){const e=this._containers;if(!e.size)return;this.callHook("beforeDrawAll");const t=[],n=[];Pe(n),oe(t);const r=[...e];e.clear(),r.forEach(e=>e.drawContainer()),oe(),t.forEach(e=>e()),n.forEach(e=>e()),this.callHook("drawnAll")}}function Le(e,t={}){let n={...t};const r=new Je(_(t.type),n,void 0===e?[]:G(e)?[e]:[J(e)]),{exposed:i}=r;return Reflect.defineProperty(i,"$update",{value:e=>(r.setChildren(void 0===e?[]:G(e)?[e]:[J(e)]),i),configurable:!0}),Reflect.defineProperty(i,"$mount",{value:e=>(i.$mounted||(e&&(n.target=e,r.setProps(n)),r.mount()),i),configurable:!0}),Reflect.defineProperty(i,"$unmount",{value(){if(i.$mounted&&!i.$unmounted)return i.$destroyed?r.destroy():void r.unmount()},configurable:!0}),n.target&&r.mount(),i}function Qe(e,t){return n=>(n[e]=t,n)}function We(e,t){return t?(t[U]=e,t):Qe(U,e)}function Xe(e,t){return t?(t[B]=e,t):Qe(B,e)}function Ye(e){return e?(e[B]="simple",e):Qe(B,"simple")}function et(e){return e?(e[B]="native",e):Qe(B,"native")}function tt(e,t){return t?(t[Z]=e,t):Qe(Z,e)}function nt(e,t){return"function"==typeof t&&(e[Z]=t),e}function rt(e,...t){for(const n of t)n(e);return e}export{R as Container,x as Deliver,o as Error,k as Fragment,g as ScopeSlot,w as Slot,m as SlotRender,D as Tags,A as Template,b as Value,O as addContextConstructor,E as callHook,S as checkCurrent,d as computed,nt as create,J as createElement,$ as current,te as defineAuxiliary,q as deliver,L as elements,a as encase,V as expose,I as hook,v as install,G as isElement,K as isElementSymbol,n as isProduction,l as isValue,W as label,We as mName,et as mNative,tt as mRender,Ye as mSimple,Xe as mType,rt as mark,t as mode,U as nameSymbol,u as recover,Oe as refresh,Le as render,Z as renderSymbol,ee as setAuxiliary,P as setHook,M as setValue,B as typeSymbol,z as useValue,c as value,e as version,T as watch};
//# sourceMappingURL=neep.core.esm.min.js.map
