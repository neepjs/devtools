/*!
 * Neep v0.1.0-alpha.9
 * (c) 2019-2020 Fierflame
 * @license MIT
 */
const e="undefined",t=!0;var n=Object.freeze({version:"undefined",isProduction:!0});function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class i extends Error{constructor(e,t=""){super(t?`[${t}] ${e}`:e),r(this,"tag",void 0),this.tag=t}}let o;function s(e){!function(e,t,n){if(!e)throw new i(t,n)}(o,"The basic renderer is not installed","install"),o(e)}const c=Object.create(null);function d(e=""){return"object"==typeof e?e:c[e]||c.default}let l,a,u,f,h,p,y,v,m,_,g;function w(e){var t;(t=e.monitorable)&&(l=t.value,a=t.computed,u=t.isValue,f=t.encase,h=t.recover,p=t.valueify,y=t.markRead,v=t.markChange,m=t.safeify,_=t.exec,g=t.createExecutable),function(e){e&&(c[e.type]=e,o||(c.default||(c.default=e),!o&&e.nextFrame&&(c.default=e,o=e.nextFrame)))}(e.render)}function b(e){return"@"===e[0]?e.substr(1):/^on[:-]/.test(e)?e.substr(3):/^n([:-])on(\1|:)/.test(e)?e.substr(5):""}function R(e,t){if(t)if("function"!=typeof t){if("object"==typeof t)for(const n of Object.keys(t)){const r=t[n];"function"==typeof r&&e(n,r)}}else{const{names:n}=t;if(!Array.isArray(n))return;for(const r of n)r&&e(r,(...e)=>t(r,...e))}}class x{static update(e,t){if(!t)return[];const n=[];if(t&&"object"==typeof t)for(const r of Object.keys(t)){if(!r)continue;const i=t[r];"function"==typeof i&&n.push(e.on(r,i))}return n}static updateInProps(e,t,n){if(!t)return[];const r=[];function i(t,n){r.push(e.on(t,n))}for(const e of Object.keys(t)){const n=t[e];if("function"!=typeof n)continue;const r=b(e);r&&i(r,n)}return R(i,t["@"]),R(i,t["n:on"]),R(i,t["n-on"]),"function"==typeof n&&n(i),r.push(...x.update(e,t["@"])),r}get names(){return[...this._names]}constructor(){r(this,"_names",new Set),r(this,"_cancelHandles",new Set),r(this,"emit",void 0),r(this,"on",void 0);const e=Object.create(null),t=this._names;function n(...r){function i(t,...n){const r=e[t];if(!r)return!0;let i=!0;for(const e of[...r])i=e(...n)&&i;return i}return i.omit=(...e)=>n(...r,...e),Reflect.defineProperty(i,"names",{get:()=>(y(n,"names"),[...t].filter(e=>!r.includes(e))),configurable:!0}),i}this.emit=n(),this.on=(r,i)=>{var o;function s(...e){try{return!1!==i(...e)}catch(e){return console.error(e),!1}}let c=e[r];(null===(o=c)||void 0===o?void 0:o.size)||(c=new Set,e[r]=c,v(n,"names"),t.add(r)),c.add(s);let d=!1;return()=>{d||(d=!0,c.delete(s),c.size||(v(n,"names"),t.delete(r)))}}}updateHandles(e){const t=this._cancelHandles,n=[...t];t.clear();for(const e of n)e();return e.forEach(e=>t.add(e)),e}update(e){const t=x.update(this,e);return this.updateHandles(t)}updateInProps(e,t){const n=x.updateInProps(this,e,t);return this.updateHandles(n)}}const A=Object.create(null);function k(e,t){A[e]=t}const D=Symbol.for("isNeepElement"),C=Symbol.for("type"),j=Symbol.for("name"),$=Symbol.for("render"),S=Symbol.for("components"),O=Symbol.for("config");function H(e,t){return n=>(n[e]=t,n)}function N(e,t,n){return r=>{let i=r[e];return i||(i=Object.create(null),r[e]=i),i[t]=n,r}}function P(e,t){return t?(t[j]=e,t):H(j,e)}function I(e,t){return t?(t[C]=e,t):H(C,e)}function E(e){return e?(e[C]="simple",e):H(C,"simple")}function T(e){return e?(e[C]="native",e):H(C,"native")}function z(e,t){return t?(t[$]=e,t):H($,e)}function M(e,t,n){const r=N(O,e,t);return n?r(n):r}function V(e,t,n){const r=N(S,e,t);return n?r(n):r}function q(e,t){return"function"==typeof t&&(e[$]=t),e}function F(e,...t){for(const n of t)n(e);return e}function K(e,t){const n=l(0),r=l(void 0);return F((function(i,{childNodes:o},{createElement:s}){const c=r();return c?s(c,i,...o):(async function(){if(!n()){n(1);try{const t=await e();if("function"==typeof t)return void r(t);if(!t)return void n(-1);if("function"==typeof t.default)return void r(t.default);n(-1)}catch(e){n(-1)}}}(),t?s(t,{loading:n()>0}):null)}),E,P("Lazy"))}const L="Neep:ScopeSlot",B="Neep:SlotRender",U="Neep:Slot",G="Neep:Value",J="Neep:Container",Q="Neep:Deliver",W="template",X=W;var Y=Object.freeze({ScopeSlot:L,SlotRender:B,Slot:U,Value:G,Container:"Neep:Container",Deliver:"Neep:Deliver",Template:W,Fragment:X});let Z;function ee(e,t){const n=Z;Z=t;try{Z.$_valueIndex=0;const t=e();if(Z.$_valueIndex!==Z.$_values.length)throw new i("Inconsistent number of useValue executions","life");return t}finally{Z=n}}function te(e,t=!1){if(!Z)throw new i(`Function \`${e}\` can only be called within a cycle.`,"life");if(!t)return Z;if(!Z.created)return Z;throw new i(`Function \`${e}\` can only be called at initialization time.`,"life")}const ne=[];function re(e,t){for(const n of ne)n(e,t);return e}function ie(e){ne.push(m(e))}const oe=Object.create(null);function se(e,t,n){let r=(null==n?void 0:n.$_hooks)||oe;if(!r)return()=>{};t=m(t);let i=r[e];return i||(i=new Set,r[e]=i),i.add(t),()=>i.delete(t)}function ce(e,t){if(t){for(const n of t.$_hooks[e]||[])n(t);for(const n of oe[e]||[])n(t)}}function de(e,t){const n=te("watch");if("function"!=typeof e)return()=>{};const r=u(e)?e.watch(t):a(e).watch((e,n)=>t(e(),n));return se("beforeDestroy",()=>r(),n),r}function le(e,t="useValue"){const n=te(t),r=n.$_valueIndex++,o=n.$_values;if(!n.created){o[r]=void 0;const t="function"==typeof e?e():l(void 0);return o[r]=t}if(r>=o.length)throw new i("Inconsistent number of useValue executions","life");return o[r]}function ae(e,t,n){const r=te("setHook");if(!n||!r.created)return se(e,()=>t(),r)}function ue(e,t,n,r){"string"==typeof t&&["$","_"].includes(t[0])||(u(n)&&r?Reflect.defineProperty(e,t,{get:()=>n(),set(e){n(e)},configurable:!0,enumerable:!0}):"function"==typeof n&&r?Reflect.defineProperty(e,t,{get:n,set:"function"==typeof r?r:void 0,configurable:!0,enumerable:!0}):Reflect.defineProperty(e,t,{get:()=>n,configurable:!0,enumerable:!0}))}function fe(e,t,n){ue(te("expose",!0).exposed,e,t,n)}function he(e,t,n){ue(te("deliver",!0).delivered,e,t,n)}var pe=Object.freeze({watch:de,useValue:le,hook:ae,expose:fe,deliver:he});function ye(e){return!!e&&("object"==typeof e&&!0===e[D])}function ve(e,t,...n){t=t?{...t}:{};const r={[D]:!0,tag:e,children:[]};if("key"in t&&(r.key=t.key),"slot"in t&&(r.slot=t.slot),"function"==typeof t.ref&&(r.ref=t.ref),e===G)return r.value=t.value,r;if(r.children=n,e===W)return r;if(e===B)return r.render=t.render,r;if(e===L||e===U){const{render:n,argv:i,args:o,name:s}=t;if(r.render=n,r.args=i&&[i]||Array.isArray(o)&&o.length&&o||[{}],e===L)return r.props={name:s},r}r.props={};for(let e in t)r.props[e]=t[e];return r}function me(e,t={}){if(Array.isArray(e)){const n=[];for(let r of e)n.push(me(r,t));return[].concat(...n)}if(!ye(e))return[e];let{tag:n}=e;if(!n)return[e];if([W,L].includes(n))return me(e.children,t);if("function"!=typeof n)return[e];if("simple"!==n[C])return[e];const{simple:r}=t;if(!r)return[e];if(Array.isArray(r)){if(r.includes(n))return[e]}else if("function"==typeof r&&!r(n))return[e];return me(e.children,t)}var _e=Object.freeze({isElement:ye,createElement:ve,elements:me});function ge(e,t=""){}var we=Object.freeze({label:ge});const be={...Y,...pe,..._e,...we,...n,get value(){return l},get computed(){return a},get isValue(){return u},get encase(){return f},get recover(){return h}};function Re(e,t){Reflect.defineProperty(be,e,{value:t,enumerable:!0,configurable:!0})}function xe(e,t){Reflect.defineProperty(be,e,{get:t,enumerable:!0,configurable:!0})}function Ae(e,t){return{...e,id:0}}function*ke(e){if(Array.isArray(e))for(const t of e)yield*ke(t);else yield e}let De;function Ce(e){De=e}function je(e,t,n){"function"==typeof e&&t&&(De?De.push(()=>e(t,n)):e(t,n))}function $e(e){if(Array.isArray(e))return $e(e[e.length-1]);const{component:t,children:n,node:r}=e;return r||$e(t?t.tree:n)}function Se(e){if(Array.isArray(e))return Se(e[0]);const{component:t,children:n,node:r}=e;return r||Se(t?t.tree:n[0])}function*Oe(e){if(Array.isArray(e)){for(const t of e)yield*Oe(t);return}const{children:t,node:n,component:r}=e;n?yield n:r?yield*Oe(r.tree):yield*Oe(t)}function He(e,t){if(Array.isArray(t))return void t.forEach(t=>He(e,t));const{component:n,children:r,node:i,ref:o}=t;return i?(je(o,i,!0),void e.remove(i)):n?(je(o,n.exposed,!0),void n.unmount()):void He(e,r)}function Ne(e,t,n){const r=Se(n);if(!r)return t;const i=e.parent(r);if(!i)return t;for(const n of Oe(t))e.insert(i,n,r);return He(e,n),t}function Pe(e,t,n){if(!t.length){return[Ne(e,Ve(e,{tag:null,children:[]}),n)]}Array.isArray(n)||(n=[n]);const r=[],i=[...n],o=new Map;for(const n of t){const t=i.findIndex(e=>e.tag===n.tag&&e.key===n.key);if(t>=0){const s=i[t],c=Ee(e,n,s);o.set(s,c),r.push(c),i.splice(t,1)}else{const t=Ve(e,n);r.push(t)}}if(!o.size)return Ne(e,r,i);He(e,i);const s=$e((n=n.filter(e=>o.has(e)))[n.length-1]),c=e.parent(s);if(!c)return r;let d=e.next(s);for(let t=r.length-1;t>=0;t--){const i=r[t],s=n.findIndex(e=>o.get(e)===i);if(s>=0)for(const e of n.splice(s))o.delete(e);else for(const t of Oe(i))e.insert(c,t,d);d=Se(i)||d}return r}function Ie(e,t,n){let r=0,i=Math.min(t.length,t.length||1);const o=[];for(;r<i;r++){const i=t[r];Array.isArray(i)?o.push(Pe(e,i,n[r])):o.push(Ee(e,i,n[r]))}if(i=Math.max(t.length,n.length),n.length>i)for(;r<i;r++)He(e,n[r]);if(t.length>i){const n=$e(o[o.length-1]),s=e.parent(n),c=e.next(n);for(;r<i;r++){const n=t[r],i=Array.isArray(n)?Me(e,n):Ve(e,n);if(o.push(i),s)for(const t of Oe(i))e.insert(s,t,c)}}return o}function Ee(e,t,n){if(Array.isArray(n)){const r=n.findIndex(e=>e.tag===t.tag&&e.component===t.component);if(r<0)return Ne(e,Ve(e,t),n);const i=n;[n]=n.splice(r,1),He(e,i)}const{tag:r,component:i}=t,o=t.ref!==n.ref&&t.ref||void 0;if(r!==n.tag||i!==n.component)return Ne(e,Ve(e,t),n);if(!r)return n;const s="string"!=typeof r?"":r.toLowerCase();if("string"!=typeof r||"neep:container"===s)return i?(je(o,i.exposed),Ae({...t,node:void 0,component:i,children:[]},n.id)):Ae({...t,node:void 0,component:void 0,children:qe(e,t.children,n.children)},n.id);if("neep:value"===s){let r=t.value;return u(r)&&(r=r()),n.value===r?(je(o,n.node),Ae({...n,...t,value:r,children:[]},n.id)):Ne(e,Te(e,t,r),n)}if("neep:"===s.substr(0,5)||"template"===s)return Ae({...t,node:void 0,component:void 0,children:Ie(e,t.children,n.children)},n.id);const{node:c}=n;if(e.update(c,t.props||{}),je(o,c),!t.children.length&&!n.children.length)return Ae({...n,...t,children:[]},n.id);if(!t.children.length&&n.children.length&&He(e,n.children),t.children.length&&!n.children.length){const r=ze(e,t.children);for(const t of Oe(r))e.insert(c,t);return Ae({...n,...t,children:r},n.id)}return Ae({...n,...t,children:Ie(e,t.children,n.children)},n.id)}function Te(e,t,n){let{ref:r}=t;if(e.isNode(n))return je(r,n),Ae({...t,value:n,node:n,children:[],component:void 0});const i=typeof n;let o;return"bigint"===i||"boolean"===i||"number"===i||"string"===i||"symbol"===i||n instanceof RegExp?o=e.text(String(n)):n instanceof Date?o=e.text(n.toISOString()):"object"===i&&n&&(o=e.text(String(n))),o||(o=e.placeholder()),je(r,o),Ae({...t,value:n,node:o,component:void 0,children:[]})}function ze(e,t){return t.length?t.map(t=>Array.isArray(t)?Me(e,t):Ve(e,t)):[Ae({tag:null,node:e.placeholder(),component:void 0,children:[]})]}function Me(e,t){return t.length?t.map(t=>Ve(e,t)):[Ae({tag:null,node:e.placeholder(),component:void 0,children:[]})]}function Ve(e,t){var n;const{tag:r,ref:i,component:o}=t;if(!r){const t=e.placeholder();return je(i,t),Ae({tag:null,node:t,component:void 0,children:[]})}const s="string"!=typeof r?"":r.toLowerCase();if("string"!=typeof r||"neep:container"===s)return o?(o.mount(),je(i,o.exposed),Ae({...t,node:void 0,component:o,children:[]})):Ae({...t,node:void 0,component:void 0,children:qe(e,t.children)});if("neep:value"===s){let n=t.value;return u(n)&&(n=n()),Te(e,t,n)}if("neep:"===s.substr(0,5)||"template"===s)return Ae({...t,node:void 0,component:void 0,children:ze(e,t.children)});const c=e.create(r,t.props||{});je(i,c);let d=[];if(null===(n=t.children)||void 0===n?void 0:n.length){d=ze(e,t.children);for(const t of Oe(d))e.insert(c,t)}return Ae({...t,node:c,component:void 0,children:d})}function qe(e,t,n){return n?Ie(e,t,n):ze(e,t)}function Fe(e,t,n,r=!1){const i=[];for(const o of t){if(Array.isArray(o)){const t=Object.create(null);i.push(Fe(e,o,t,r));for(const e of Reflect.ownKeys(t))e in n?n[e].push(t[e]):n[e]=[t[e]];continue}if(r){if(e.isNode(o)){i.push(o);continue}if(!ye(o)){i.push(o);continue}if(o.tag!==B){i.push(o);continue}}const t=ye(o)&&o.slot||"default",s=ye(o)?{...o,slot:void 0,props:{...o.props,slot:void 0}}:o;t in n?n[t].push(s):n[t]=[s]}return i}function Ke(e,...t){return e.map(e=>Array.isArray(e)?Ke(e,...t):ye(e)?e.tag!==B?{...e,slot:void 0}:"function"==typeof e.render?e.render(...t):e.children:e)}function Le(e,t){const n=(...e)=>({[D]:!0,tag:L,children:Ke(t,...e),inserted:!0,label:void 0});return n.children=t,n}function Be(e,t=Object.create(null)){for(const n of Reflect.ownKeys(t))n in e||delete t[n];for(const n of Reflect.ownKeys(e))t[n]=Le(0,e[n]);return t}const Ue=new Set([":","@","#","*","!","%","^","~","&","=","+",".","(",")","[","]","{","}","<",">"]);function Ge(e){return"string"!=typeof e||!Ue.has(e[0])&&(!/^n[:-]/.test(e)&&!/^on[:-]/.test(e))}function Je(e,t,n={},r=!1,i=!1){const o=Reflect.ownKeys(t),s=new Set(i?o.filter(Ge):o);for(const t of Reflect.ownKeys(e))s.has(t)||delete e[t];if(!r){for(const n of s)e[n]=t[n];return e}for(const r of s){const i=t[r];r in n&&n[r]===i||(u(i)?Reflect.defineProperty(e,r,{configurable:!0,enumerable:!0,get:()=>i(),set(e){i(e)}}):Reflect.defineProperty(e,r,{configurable:!0,enumerable:!0,value:i}))}return e}function Qe(...e){return e.filter(Boolean)}function We(e,t){if(!e)return null;if("string"!=typeof e)return e;if("template"===e)return e;if(/^neep:.+/i.test(e))return e;for(const n of t){const t=n[e];if(t)return t}return A[e]||e}function Xe(e,t,n,r,i,o=!1){if(Array.isArray(n))return n.map(n=>Xe(e,t,n,r,i,o));if(!ye(n))return n;const{inserted:s,args:c=[{}]}=n;let d=We(n.tag,i);if("Neep:Deliver"===d){const s={...n.props};delete s.ref,delete s.slot,delete s.key;const c=Object.create(t);return Je(c,s||{},{},!0),{...n,tag:d,$__neep__delivered:c,children:n.children.map(t=>Xe(e,c,t,r,i,o))}}const l=n.children.map(n=>Xe(e,t,n,r,i,o));return"function"==typeof d?"simple"===d[C]?function(e,t,n,r,i,o){const{iRender:s}=e,c=Object.create(null);Fe(s,o,c);const d=Be(c),l=new x;l.updateInProps(n.props);const a={...n.props},u=re({slots:d,created:!1,parent:e.exposed,delivered:t,children:new Set,childNodes:o,refresh(t){e.refresh(t)},emit:l.emit,valueifyProp:p(a)}),f=r(a,u,be),h=Xe(e,t,Ye(s,f,u,r[$]),d,Qe(...i,r[S]));return{...n,tag:r,children:Array.isArray(h)?h:[h],label:void 0}}(e,t,n,d,i,Xe(e,t,l,r,i,o)):{...n,$__neep__delivered:t,children:l,tag:d}:(d===U&&(d=o?"slot":L),d!==L||s?{...n,children:l,tag:d}:function(e,t,n,r,i,o,s=[{}],c){var d;const l=r[(null===(d=n.props)||void 0===d?void 0:d.name)||"default"];if("function"==typeof l)return{...n,...l(...s)};const{render:a}=n;return{...n,tag:L,label:void 0,children:Xe(e,t,"function"!=typeof a?o:a(...s),r,i,c)}}(e,t,{...n,tag:d},r,i,l,c,o))}function Ye(e,t,n,r){return Array.isArray(t)?t:ye(t)?[t]:null==t?[{[D]:!0,tag:null,children:[]}]:(!e.isNode(t)&&t&&"object"==typeof t&&r&&(t=r(t,n,be)),ye(t)?[t]:null==t?[{[D]:!0,tag:null,children:[]}]:[{[D]:!0,tag:G,value:t,children:[]}])}function Ze(e,t){const{component:n}=e;return Xe(e,e.delivered,Ye(e.iRender,t,e.context,n[$]),e.context.slots,Qe(n[S]),Boolean(e.native))}let et=0;const tt=new Set;function nt(e){return!(et<=0)&&(tt.add(e),!0)}function rt(){if(et>0)return;const e=[...tt];tt.clear(),e.forEach(e=>e.refresh())}function it(e,t){if(t)return async function(e){try{return et++,await e()}finally{et--,rt()}}(e);try{return et++,e()}finally{et--,rt()}}let ot;function st(e){ot=e}function ct(e){ot?ot.push(e):e()}class dt{constructor(e,t,n=(null==t?void 0:t.delivered)||Object.create(null),i){r(this,"events",new x),r(this,"emit",this.events.emit),r(this,"on",this.events.on),r(this,"eventCancelHandles",new Set),r(this,"iRender",void 0),r(this,"components",Object.create(null)),r(this,"config",Object.create(null)),r(this,"parentDelivered",void 0),r(this,"delivered",void 0),r(this,"exposed",function(e){const t={$parent:{configurable:!0,get:()=>{var t;return null===(t=e.parent)||void 0===t?void 0:t.exposed}},$component:{configurable:!0,value:null},$isContainer:{configurable:!0,value:!1},$created:{configurable:!0,get:()=>e.created},$destroyed:{configurable:!0,get:()=>e.destroyed},$mounted:{configurable:!0,get:()=>e.mounted},$unmounted:{configurable:!0,get:()=>e.unmounted}};return Object.create(null,t)}(this)),r(this,"entity",function(e){const t={exposed:{configurable:!0,get:()=>e.exposed},delivered:{configurable:!0,get:()=>e.delivered},parent:{configurable:!0,get:()=>{var t;return null===(t=e.parent)||void 0===t?void 0:t.entity}},component:{configurable:!0,value:null},isContainer:{configurable:!0,value:!1},created:{configurable:!0,get:()=>e.created},destroyed:{configurable:!0,get:()=>e.destroyed},mounted:{configurable:!0,get:()=>e.mounted},unmounted:{configurable:!0,get:()=>e.unmounted},$_hooks:{configurable:!0,value:Object.create(null)},$_valueIndex:{configurable:!0,value:0,writable:!0},$_values:{configurable:!0,value:[]},callHook:{configurable:!0,value(e){ce(e,n)}},setHook:{configurable:!0,value:(e,t)=>se(e,t,n)},refresh:{configurable:!0,value:e.refresh.bind(e)},on:{configurable:!0,value:e.on},emit:{configurable:!0,value:e.emit},config:{configurable:!0,value:e.config}},n=Object.create(null,t);return n}(this)),r(this,"parent",void 0),r(this,"native",void 0),r(this,"created",!1),r(this,"destroyed",!1),r(this,"mounted",!1),r(this,"unmounted",!1),r(this,"children",new Set),r(this,"tree",[]),r(this,"container",void 0),r(this,"_render",()=>[]),r(this,"_needRefresh",!1),r(this,"_delayedRefresh",0),r(this,"_refreshing",!1),r(this,"_nodes",[]),r(this,"childNodes",[]),r(this,"__executed_destroy",!1),r(this,"__executed_mount",!1),r(this,"__executed_mounted",!1),r(this,"_cancelDrawMonitor",void 0),this.iRender=e,this.parentDelivered=n,this.delivered=Object.create(n),t&&(this.parent=t),this.container=i||this}get canRefresh(){return!nt(this)&&!this._delayedRefresh}get needRefresh(){if(nt(this))return!1;if(this._delayedRefresh)return!1;const e=this._needRefresh;return this._needRefresh=!1,e}requestDraw(){}async asyncRefresh(e){try{return this._delayedRefresh++,await e()}finally{this._delayedRefresh--,this.refresh()}}refresh(e,t){if("function"==typeof e){if(t)return this.asyncRefresh(e);try{return this._delayedRefresh++,e()}finally{this._delayedRefresh--,this._delayedRefresh<=0&&this.refresh()}}if(this.destroyed)return;if(this._needRefresh=!0,!this.created)return;if(this._refreshing)return;let n;for(this._refreshing=!0;this.needRefresh;)if(n=this._render(),this.destroyed)return;this._refreshing=!1,this.canRefresh&&n&&(this._nodes=mt(this,n,this._nodes),this.mounted&&(this.destroyed||this.unmounted||this.requestDraw()))}callHook(e){ce(e,this.entity)}_update(e,t){this.childNodes=t}update(e,t){this._update(e,t)}_destroy(){}destroy(){this.__executed_destroy||(this.__executed_destroy=!0,this.callHook("beforeDestroy"),this._destroy(),this.callHook("destroyed"),this.destroyed=!0)}_mount(){}mount(){if(this.__executed_destroy)return;if(this.__executed_mount)return;this.__executed_mount=!0,this.callHook("beforeMount");const e=_(e=>e&&this.requestDraw(),()=>{this._mount(),this.mounted=!0});this._cancelDrawMonitor=e.stop,ct(()=>this.callHook("mounted"))}_unmount(){}unmount(){this.mounted&&(this.__executed_mounted||(this.__executed_mounted=!0,this.callHook("beforeUnmount"),this._unmount(),this.callHook("unmounted"),this.unmounted=!0))}_draw(){}draw(){var e;if(this.__executed_destroy)return;null===(e=this._cancelDrawMonitor)||void 0===e||e.call(this),this.callHook("beforeUpdate");const t=_(e=>e&&this.requestDraw(),()=>this._draw());this._cancelDrawMonitor=t.stop,ct(()=>this.callHook("updated"))}}function lt(e,t,n){Je(e.props,t,{},!1,!0),e.events.updateInProps(t);const r=Object.create(null),{native:i}=e,o=Fe(e.iRender,n,r,Boolean(i));Be(r,e.slots),i&&(e.nativeNodes=mt(e,o,e.nativeNodes),e.mounted&&e.requestDraw())}class at extends dt{constructor(e,t,n,i,o){var s,c;super(i.iRender,i,o,i.container),r(this,"component",void 0),r(this,"props",f(Object.create(null))),r(this,"slots",f(Object.create(null))),r(this,"_stopRender",void 0),r(this,"nativeNodes",void 0),r(this,"shadowTree",[]),r(this,"nativeTree",[]),r(this,"_shadow",void 0),r(this,"context",void 0),r(this,"parent",void 0),this.component=e,Object.assign(this.config,e[O]),Object.assign(this.components,e[S]),Reflect.defineProperty(this.exposed,"$component",{value:e,enumerable:!0,configurable:!0}),[this.native,this._shadow]="native"===e[C]&&(null===(s=(c=this.iRender).component)||void 0===s?void 0:s.call(c))||[],this.parent=i,i.children.add(this.exposed);const d=re({slots:(l=this).slots,get created(){return l.created},get parent(){return l.parent.exposed},get delivered(){return l.parentDelivered},get children(){return l.children},get childNodes(){return l.childNodes},get emit(){return l.emit},refresh(e){l.refresh(e)},valueifyProp:p(l.props)},l.exposed);var l;this.context=d,this.callHook("beforeCreate"),this.childNodes=n,it(()=>lt(this,t,n));const{render:a,nodes:u,stopRender:h}=function(e){const{component:t,props:n,context:r,entity:i}=e,o=t=>t&&e.refresh(),s=_(o,()=>ee(()=>t(n,r,be),i),{resultOnly:!0});if("function"==typeof s){const t=g(o,()=>Ze(e,s()));return{nodes:t(),render:t,stopRender:()=>t.stop()}}const c=g(o,()=>Ze(e,ee(()=>t(n,r,be),i)));return{nodes:_(o,()=>Ze(e,s),{resultOnly:!0}),render:c,stopRender:()=>c.stop()}}(this);this._render=a,this._stopRender=h,this._nodes=mt(this,u),this.callHook("created"),this.created=!0,this._needRefresh&&this.refresh()}_update(e,t){this.destroyed||(this.childNodes=t,it(()=>lt(this,e,t)))}_destroy(){this._stopRender&&this._stopRender(),this.parent.children.delete(this.exposed),ft(this._nodes)}requestDraw(){this.container.markDraw(this)}_draw(){const{nativeNodes:e,iRender:t,_shadow:n,native:r}=this;r&&e&&n?(this.shadowTree=qe(t,this._nodes,this.shadowTree),this.nativeTree=qe(t,e,this.nativeTree)):this.tree=qe(t,this._nodes,this.tree)}_mount(){const{nativeNodes:e,iRender:t,_shadow:n,native:r,_nodes:i}=this;if(r&&e&&n){this.tree=qe(t,mt(this,r)),this.shadowTree=qe(t,i);for(const e of Oe(this.shadowTree))t.insert(n,e);this.nativeTree=qe(t,e);for(const e of Oe(this.nativeTree))t.insert(r,e)}else this.tree=qe(t,i)}_unmount(){const{iRender:e,nativeTree:t}=this;He(e,this.tree),t&&He(e,t)}}function ut(e){return!1===e||null==e?null:ye(e)?e:{[D]:!0,tag:"Neep:Value",key:e,value:e,children:[]}}function ft(e){if(Array.isArray(e))return void e.forEach(e=>ft(e));const{component:t}=e;t&&t.destroy()}function ht(e,t){if(!t)return{tag:null,children:[]};const{tag:n}=t;if(!n)return{tag:null,children:[]};if("string"!=typeof n)return"simple"===n[C]?{...t,children:mt(e,t.children),component:void 0}:{...t,children:[],component:new at(n,t.props||{},t.children,e,t.$__neep__delivered)};const r=n.toLowerCase();if("neep:container"===r){var i;const n=null==t?void 0:null===(i=t.props)||void 0===i?void 0:i.type,r=n?d(n):e.iRender;return{...t,children:[],component:new wt(r,t.props||{},t.children,e,t.$__neep__delivered)}}return"neep:value"===r?{...t,children:[]}:(r.substr(0,5),{...t,children:mt(e,t.children)})}function pt(e,t,n){Array.isArray(n)||(n=[n]);const r=[];for(const i of ke(t)){const t=ut(i);if(!t)continue;const o=n.findIndex(e=>e.tag===t.tag&&e.key===t.key);o>=0?(r.push(yt(e,t,n[o])),n.splice(o,1)):r.push(ht(e,t))}return ft(n),r}function yt(e,t,n){if(!n)return ht(e,t);if(!t)return ft(n),{tag:null,children:[]};if(Array.isArray(n)){if(!n.length)return ht(e,t);const r=n.findIndex(e=>e.tag===t.tag);if(r<0)return ft(n),ht(e,t);const i=n;[n]=n.splice(r,1),ft(i)}const{tag:r}=t;if(r!==n.tag)return ft(n),ht(e,t);if(!r)return{tag:null,children:[]};if("string"!=typeof r){if("simple"===r[C])return{...t,children:mt(e,t.children,n.children),component:void 0};const{component:i}=n;return i?(i.update(t.props||{},t.children),{...t,children:[],component:i}):ht(e,t)}const i=r.toLowerCase();if("neep:container"===i){var o;const{component:r}=n;if(!r)return ht(e,t);const i=null==t?void 0:null===(o=t.props)||void 0===o?void 0:o.type;return(i?d(i):e.iRender)!==r.iRender?ht(e,t):(r.update(t.props||{},t.children),{...t,children:[],component:r})}if("neep:value"===i)return{...t,children:[]};if("neep:"===i.substr(0,5)||"template"===i){let r;if("neep:deliver"===i){const e={...t.props};delete e.ref,delete e.slot,delete e.key,r=Je(n.$__neep__delivered,e,n.props,!0)}return{...t,$__neep__delivered:r,children:mt(e,t.children,n.children)}}return{...t,children:mt(e,t.children,n.children)}}function*vt(e,t,n){let r=0,i=Math.min(t.length,t.length);for(;r<i;r++){const i=t[r];Array.isArray(i)?yield pt(e,i,n[r]):yield yt(e,ut(i),n[r])}if(i=Math.max(t.length,t.length),n.length>i)for(;r<i;r++)ft(n[r]);if(t.length>i)for(;r<i;r++){const n=ut(t[r]);Array.isArray(n)?yield[...ke(n)].map(t=>ht(e,t)):yield ht(e,n)}}function mt(e,t,n){return Array.isArray(t)||(t=[t]),n?[...vt(e,t,n)]:function(e,t){return t.length?t.map(t=>Array.isArray(t)?[...ke(t)].map(t=>ht(e,ut(t))):ht(e,ut(t))):[]}(e,t)}let _t=new Set,gt=!1;class wt extends dt{constructor(e,t,n,i,o){super(e,i,o),r(this,"props",void 0),r(this,"content",[]),r(this,"_node",null),r(this,"_container",null),r(this,"rootContainer",this),r(this,"_drawChildren",!1),r(this,"_drawContainer",!1),r(this,"_awaitDraw",new Set),r(this,"_needDraw",!1),r(this,"_containers",new Set),this.props=t,this.parent=i,i&&(this.rootContainer=i.container.rootContainer),this.callHook("beforeCreate"),this._render=()=>n,this._nodes=mt(this,n),this.callHook("created"),this.created=!0}setChildren(e){this.destroyed||(this.childNodes=e,this._render=()=>e,this._drawChildren=!0,this.refresh())}setProps(e){this.destroyed||(this.props=e,this._drawContainer=!0,this.refresh())}update(e,t){this.refresh(()=>{this.setProps(e),this.setChildren(t)})}requestDraw(){this.markDraw(this)}_mount(){const{props:e,parent:t,iRender:n}=this,r=qe(this.container.iRender,this._nodes);this.content=r;const[i,o]=n.mount(e,null==t?void 0:t.iRender);for(const e of Oe(r))n.insert(i,e);this.tree=[Ae({tag:G,component:void 0,node:o,value:o,children:[]})],this._node=o,this._container=i}_destroy(){ft(this.content)}_unmount(){const{parent:e,iRender:t}=this;e&&He(e.iRender,this.tree),t.unmount(this._container,this._node,Boolean(e)),He(this.iRender,this.content)}_draw(){const{_drawChildren:e,_drawContainer:t}=this;var n;(this._drawContainer=!1,t)&&this.iRender.drawContainer(this._container,this._node,this.props,null===(n=this.parent)||void 0===n?void 0:n.iRender);this.parent&&this.parent.iRender!==this.iRender||(this._drawChildren=!1,e&&(this.content=qe(this.iRender,this._nodes,this.content)))}_drawSelf(){const{_drawChildren:e,_drawContainer:t}=this;var n;(this._needDraw=!1,this._drawChildren=!1,this._drawContainer=!1,t)&&this.iRender.drawContainer(this._container,this._node,this.props,null===(n=this.parent)||void 0===n?void 0:n.iRender,!0);e&&(this.content=qe(this.iRender,this._nodes,this.content))}drawSelf(){this.mounted&&(this.destroyed||(this.callHook("beforeUpdate"),_(e=>e&&this.markDraw(this),()=>this._drawSelf()),ct(()=>this.callHook("updated"))))}markDraw(e,t=!1){var n;(null===(n=this.parent)||void 0===n?void 0:n.iRender)!==this.iRender?(e===this&&this.parent?(this.parent.container.markDraw(this,t),this._needDraw=!t):t?this._awaitDraw.delete(e):this._awaitDraw.add(e),this.rootContainer.markDrawContainer(this,!this._needDraw&&!this._awaitDraw.size||this.destroyed)):this.parent.container.markDraw(e,t)}drawContainer(){const{_node:e,_container:t,_awaitDraw:n}=this;if(!e||!t)return;this.callHook("beforeDraw");const r=this._needDraw;this._needDraw=!1;const i=[...n];n.clear(),r&&this.drawSelf(),i.map(e=>e.draw()),this.iRender.draw(t,e),ct(()=>this.callHook("drawn"))}markDrawContainer(e,t=!1){var n;t?this._containers.delete(e):this._containers.add(e),n=this,_t.add(n),gt||(gt=!0,s(()=>{gt=!1;const e=[..._t];_t.clear(),e.map(e=>e.drawAll())}))}drawAll(){const e=this._containers;if(!e.size)return;this.callHook("beforeDrawAll");const t=[],n=[];st(n),Ce(t);const r=[...e];e.clear(),r.forEach(e=>e.drawContainer()),Ce(),t.forEach(e=>e()),n.forEach(e=>e()),this.callHook("drawnAll")}}function bt(e,t={}){let n={...t};const r=new wt(d(t.type),n,void 0===e?[]:ye(e)?[e]:[ve(e)]),{exposed:i}=r;return Reflect.defineProperty(i,"$update",{value:e=>(r.setChildren(void 0===e?[]:ye(e)?[e]:[ve(e)]),i),configurable:!0}),Reflect.defineProperty(i,"$mount",{value:e=>i.$mounted?i:(e&&(n.target=e,r.setProps(n)),r.mount(),i),configurable:!0}),Reflect.defineProperty(i,"$unmount",{value(){if(i.$mounted&&!i.$unmounted)return i.$destroyed?r.destroy():void r.unmount()},configurable:!0}),n.target&&r.mount(),i}export{J as Container,Q as Deliver,i as Error,x as EventEmitter,X as Fragment,L as ScopeSlot,U as Slot,B as SlotRender,Y as Tags,W as Template,G as Value,ie as addContextConstructor,ce as callHook,te as checkCurrent,S as componentsSymbol,a as computed,O as configSymbol,q as create,ve as createElement,Z as current,xe as defineAuxiliary,he as deliver,me as elements,f as encase,fe as expose,ae as hook,w as install,ye as isElement,D as isElementSymbol,t as isProduction,u as isValue,ge as label,K as lazy,V as mComponent,M as mConfig,P as mName,T as mNative,z as mRender,E as mSimple,I as mType,F as mark,j as nameSymbol,h as recover,it as refresh,k as register,bt as render,$ as renderSymbol,Re as setAuxiliary,se as setHook,C as typeSymbol,le as useValue,l as value,p as valueify,e as version,de as watch};
