/*!
 * Neep v0.1.0-alpha.8
 * (c) 2019-2020 Fierflame
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("monitorable")):"function"==typeof define&&define.amd?define(["exports","monitorable"],t):t((e=e||self).Neep={},e.Monitorable)}(this,(function(e,t){"use strict";const n="production";var r=Object.freeze({version:"undefined",mode:n,isProduction:!0});function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){return"@"===e[0]?e.substr(1):/^on[:-]/.test(e)?e.substr(3):/^n([:-])on(\1|:)/.test(e)?e.substr(5):""}function s(e,t){if(t)if("function"!=typeof t){if("object"==typeof t)for(const n of Object.keys(t)){const r=t[n];"function"==typeof r&&e(n,r)}}else{const{names:n}=t;if(!Array.isArray(n))return;for(const r of n)r&&e(r,(...e)=>t(r,...e))}}class c{static update(e,t){if(!t)return[];const n=[];if(t&&"object"==typeof t)for(const r of Object.keys(t)){if(!r)continue;const i=t[r];"function"==typeof i&&n.push(e.on(r,i))}return n}static updateInProps(e,t,n){if(!t)return[];const r=[];function i(t,n){r.push(e.on(t,n))}for(const e of Object.keys(t)){const n=t[e];if("function"!=typeof n)continue;const r=o(e);r&&i(r,n)}return s(i,t["@"]),s(i,t["n:on"]),s(i,t["n-on"]),"function"==typeof n&&n(i),r.push(...c.update(e,t["@"])),r}get names(){return this._names}constructor(){i(this,"_names",[]),i(this,"_cancelHandles",new Set),i(this,"emit",void 0),i(this,"on",void 0);const e=Object.create(null),t=this._names;function n(...r){function i(t,...n){const r=e[t];if(r)for(const e of[...r])e(...n)}return i.omit=(...e)=>n(...r,...e),Reflect.defineProperty(i,"names",{get:()=>(a.markRead(n,"names"),t.filter(e=>!r.includes(e))),configurable:!0}),i}this.emit=n(),this.on=(t,r)=>{const i=a.safeify(r);let o=e[t];o||(o=new Set,e[t]=o,a.markChange(n,"names"),this._names=[...this._names,t]),o.add(i);let s=!1;return()=>{s||(s=!0,o.delete(i),o.size||(a.markChange(n,"names"),this._names=this._names.filter(e=>e!==t)))}}}updateHandles(e){const t=this._cancelHandles,n=[...t];t.clear();for(const e of n)e();return e.forEach(e=>t.add(e)),e}update(e){const t=c.update(this,e);return this.updateHandles(t)}updateInProps(e,t){const n=c.updateInProps(this,e,t);return this.updateHandles(n)}}class l extends Error{constructor(e,t=""){super(t?`[${t}] ${e}`:e),i(this,"tag",void 0),this.tag=t}}let a,d;function u(e){!function(e,t,n){if(!e)throw new l(t,n)}(d,"The basic renderer is not installed","install"),d(e)}const f=Object.create(null);function h(e=""){return"object"==typeof e?e:f[e]||f.default}function p(t){t&&(t.install&&t.install({get isValue(){return e.isValue},EventEmitter:c,Error:l}),f[t.type]=t,d||(f.default||(f.default=t),!d&&t.nextFrame&&(f.default=t,d=t.nextFrame)))}function y(t){var n;(n=t.monitorable)&&(a=n,e.value=a.value,e.computed=a.computed,e.isValue=a.isValue,e.encase=a.encase,e.recover=a.recover),function({render:e,renders:t}){if(p(e),Array.isArray(t))for(const e of t)p(e)}(t)}const m=Object.create(null);const v=Symbol.for("isNeepElement"),_=Symbol.for("type"),g=Symbol.for("name"),b=Symbol.for("render"),w=Symbol.for("components"),R=Symbol.for("config");function x(e,t){return n=>(n[e]=t,n)}function A(e,t,n){return r=>{let i=r[e];return i||(i=Object.create(null),r[e]=i),i[t]=n,r}}function k(e,t){return t?(t[g]=e,t):x(g,e)}function S(e){return e?(e[_]="simple",e):x(_,"simple")}function D(e,...t){for(const n of t)n(e);return e}const C="Neep:ScopeSlot",j="Neep:SlotRender",$="Neep:Slot",O="Neep:Value",H="Neep:Container",N="Neep:Deliver",E="template",P=E;var V=Object.freeze({ScopeSlot:C,SlotRender:j,Slot:$,Value:O,Container:H,Deliver:N,Template:E,Fragment:P});function I(t,n){const r=e.current;e.current=n;try{e.current.$_valueIndex=0;const n=t();if(e.current.$_valueIndex!==e.current.$_values.length)throw new l("Inconsistent number of useValue executions","life");return n}finally{e.current=r}}function T(t,n=!1){if(!e.current)throw new l(`Function \`${t}\` can only be called within a cycle.`,"life");if(!n)return e.current;if(!e.current.created)return e.current;throw new l(`Function \`${t}\` can only be called at initialization time.`,"life")}const z=[];function M(e,t){for(const n of z)n(e,t);return e}const q=Object.create(null);function F(e,t,n){let r=(null==n?void 0:n.$_hooks)||q;if(!r)return()=>{};t=a.safeify(t);let i=r[e];return i||(i=new Set,r[e]=i),i.add(t),()=>i.delete(t)}function K(e,t){if(t){for(const n of t.$_hooks[e]||[])n(t);for(const n of q[e]||[])n(t)}}function B(t,n){const r=T("watch");if("function"!=typeof t)return()=>{};const i=e.isValue(t)?t.watch(n):e.computed(t).watch((e,t)=>n(e(),t));return F("beforeDestroy",()=>i(),r),i}function U(t,n="useValue"){const r=T(n),i=r.$_valueIndex++,o=r.$_values;if(!r.created){o[i]=void 0;const n="function"==typeof t?t():e.value(void 0);return o[i]=n}if(i>=o.length)throw new l("Inconsistent number of useValue executions","life");return o[i]}function L(e,t,n){const r=T("setHook");if(!n||!r.created)return F(e,()=>t(),r)}function G(t,n,r,i){"string"==typeof n&&["$","_"].includes(n[0])||(e.isValue(r)&&i?Reflect.defineProperty(t,n,{get:()=>r(),set(e){r(e)},configurable:!0,enumerable:!0}):"function"==typeof r&&i?Reflect.defineProperty(t,n,{get:r,set:"function"==typeof i?i:void 0,configurable:!0,enumerable:!0}):Reflect.defineProperty(t,n,{get:()=>r,configurable:!0,enumerable:!0}))}function J(e,t,n){G(T("expose",!0).exposed,e,t,n)}function Q(e,t,n){G(T("deliver",!0).delivered,e,t,n)}var W=Object.freeze({watch:B,useValue:U,hook:L,expose:J,deliver:Q});function X(e){return!!e&&("object"==typeof e&&!0===e[v])}function Y(e,t,...n){t=t?{...t}:{};const r={[v]:!0,tag:e,children:[]};if("key"in t&&(r.key=t.key),"slot"in t&&(r.slot=t.slot),"function"==typeof t.ref&&(r.ref=t.ref),e===O)return r.value=t.value,r;if(r.children=n,e===E)return r;if(e===j)return r.render=t.render,r;if(e===C||e===$){const{render:n,argv:i,args:o,name:s}=t;if(r.render=n,r.args=i&&[i]||Array.isArray(o)&&o.length&&o||[{}],e===C)return r.props={name:s},r}r.props={};for(let e in t)r.props[e]=t[e];return r}function Z(e,t={}){if(Array.isArray(e)){const n=[];for(let r of e)n.push(Z(r,t));return[].concat(...n)}if(!X(e))return[e];let{tag:n}=e;if(!n)return[];if([E,C].includes(n))return Z(e.children,t);if("function"!=typeof n)return[e];if("simple"!==n[_])return[e];const{simple:r}=t;if(!r)return[e];if(Array.isArray(r)){if(r.includes(n))return[e]}else if("function"==typeof r&&!r(n))return[e];return Z(e.children,t)}var ee=Object.freeze({isElement:X,createElement:Y,elements:Z});function te(e,t=""){}var ne=Object.freeze({label:te});const re={...V,...W,...ee,...ne,...r,get value(){return e.value},get computed(){return e.computed},get isValue(){return e.isValue},get encase(){return e.encase},get recover(){return e.recover}};function ie(e,t){return{...e,id:0}}function*oe(e){if(Array.isArray(e))for(const t of e)yield*oe(t);else yield e}let se;function ce(e){se=e}function le(e,t,n){"function"==typeof e&&t&&(se?se.push(()=>e(t,n)):e(t,n))}function ae(e){if(Array.isArray(e))return ae(e[e.length-1]);const{component:t,children:n,node:r}=e;return r||ae(t?t.tree:n)}function de(e){if(Array.isArray(e))return de(e[0]);const{component:t,children:n,node:r}=e;return r||de(t?t.tree:n[0])}function*ue(e){if(Array.isArray(e)){for(const t of e)yield*ue(t);return}const{children:t,node:n,component:r}=e;n?yield n:r?yield*ue(r.tree):yield*ue(t)}function fe(e,t){if(Array.isArray(t))return void t.forEach(t=>fe(e,t));const{component:n,children:r,node:i,ref:o}=t;return i?(le(o,i,!0),void e.remove(i)):n?(le(o,n.exposed,!0),void n.unmount()):void fe(e,r)}function he(e,t,n){const r=de(n);if(!r)return t;const i=e.parent(r);if(!i)return t;for(const n of ue(t))e.insert(i,n,r);return fe(e,n),t}function pe(e,t,n){if(!t.length){return[he(e,be(e,{tag:null,children:[]}),n)]}Array.isArray(n)||(n=[n]);const r=[],i=[...n],o=new Map;for(const n of t){const t=i.findIndex(e=>e.tag===n.tag&&e.key===n.key);if(t>=0){const s=i[t],c=me(e,n,s);o.set(s,c),r.push(c),i.splice(t,1)}else{const t=be(e,n);r.push(t)}}if(!o.size)return he(e,r,i);fe(e,i);const s=ae((n=n.filter(e=>o.has(e)))[n.length-1]),c=e.parent(s);if(!c)return r;let l=e.next(s);for(let t=r.length-1;t>=0;t--){const i=r[t],s=n.findIndex(e=>o.get(e)===i);if(s>=0)for(const e of n.splice(s))o.delete(e);else for(const t of ue(i))e.insert(c,t,l);l=de(i)||l}return r}function ye(e,t,n){let r=0,i=Math.min(t.length,t.length||1);const o=[];for(;r<i;r++){const i=t[r];Array.isArray(i)?o.push(pe(e,i,n[r])):o.push(me(e,i,n[r]))}if(i=Math.max(t.length,n.length),n.length>i)for(;r<i;r++)fe(e,n[r]);if(t.length>i){const n=ae(o[o.length-1]),s=e.parent(n),c=e.next(n);for(;r<i;r++){const n=t[r],i=Array.isArray(n)?ge(e,n):be(e,n);if(o.push(i),s)for(const t of ue(i))e.insert(s,t,c)}}return o}function me(t,n,r){if(Array.isArray(r)){const e=r.findIndex(e=>e.tag===n.tag&&e.component===n.component);if(e<0)return he(t,be(t,n),r);const i=r;[r]=r.splice(e,1),fe(t,i)}const{tag:i,component:o}=n,s=n.ref!==r.ref&&n.ref||void 0;if(i!==r.tag||o!==r.component)return he(t,be(t,n),r);if(!i)return r;if("string"!=typeof i||i===H)return o?(le(s,o.exposed),ie({...n,node:void 0,component:o,children:[]},r.id)):ie({...n,node:void 0,component:void 0,children:we(t,n.children,r.children)},r.id);if(i===O){let i=n.value;return e.isValue(i)&&(i=i()),r.value===i?(le(s,r.node),ie({...r,...n,value:i,children:[]},r.id)):he(t,ve(t,n,i),r)}if(i===E||"Neep:"===i.substr(0,5))return ie({...n,node:void 0,component:void 0,children:ye(t,n.children,r.children)},r.id);const{node:c}=r;if(t.update(c,n.props||{}),le(s,c),!n.children.length&&!r.children.length)return ie({...r,...n,children:[]},r.id);if(!n.children.length&&r.children.length&&fe(t,r.children),n.children.length&&!r.children.length){const e=_e(t,n.children);for(const n of ue(e))t.insert(c,n);return ie({...r,...n,children:e},r.id)}return ie({...r,...n,children:ye(t,n.children,r.children)},r.id)}function ve(e,t,n){let{ref:r}=t;if(e.isNode(n))return le(r,n),ie({...t,value:n,node:n,children:[],component:void 0});const i=typeof n;let o;return"bigint"===i||"boolean"===i||"number"===i||"string"===i||"symbol"===i||n instanceof RegExp?o=e.text(String(n)):n instanceof Date?o=e.text(n.toISOString()):"object"===i&&n&&(o=e.text(String(n))),o||(o=e.placeholder()),le(r,o),ie({...t,value:n,node:o,component:void 0,children:[]})}function _e(e,t){return t.length?t.map(t=>Array.isArray(t)?ge(e,t):be(e,t)):[ie({tag:null,node:e.placeholder(),component:void 0,children:[]})]}function ge(e,t){return t.length?t.map(t=>be(e,t)):[ie({tag:null,node:e.placeholder(),component:void 0,children:[]})]}function be(t,n){var r;const{tag:i,ref:o,component:s}=n;if(!i){const e=t.placeholder();return le(o,e),ie({tag:null,node:e,component:void 0,children:[]})}if("string"!=typeof i||i===H)return s?(s.mount(),le(o,s.exposed),ie({...n,node:void 0,component:s,children:[]})):ie({...n,node:void 0,component:void 0,children:we(t,n.children)});if(i===O){let r=n.value;return e.isValue(r)&&(r=r()),ve(t,n,r)}if(i===E||"Neep:"===i.substr(0,5))return ie({...n,node:void 0,component:void 0,children:_e(t,n.children)});const c=t.create(i,n.props||{});le(o,c);let l=[];if(null===(r=n.children)||void 0===r?void 0:r.length){l=_e(t,n.children);for(const e of ue(l))t.insert(c,e)}return ie({...n,node:c,component:void 0,children:l})}function we(e,t,n){return n?ye(e,t,n):_e(e,t)}function Re(e,t,n,r=!1){const i=[];for(const o of t){if(Array.isArray(o)){const t=Object.create(null);i.push(Re(e,o,t,r));for(const e of Reflect.ownKeys(t))e in n?n[e].push(t[e]):n[e]=[t[e]];continue}if(r){if(e.isNode(o)){i.push(o);continue}if(!X(o)){i.push(o);continue}if(o.tag!==j){i.push(o);continue}}const t=X(o)&&o.slot||"default",s=X(o)?{...o,slot:void 0,props:{...o.props,slot:void 0}}:o;t in n?n[t].push(s):n[t]=[s]}return i}function xe(e,...t){return e.map(e=>Array.isArray(e)?xe(e,...t):X(e)?e.tag!==j?{...e,slot:void 0}:"function"==typeof e.render?e.render(...t):e.children:e)}function Ae(e,t){const n=(...e)=>({[v]:!0,tag:C,children:xe(t,...e),inserted:!0,label:void 0});return n.children=t,n}function ke(e,t=Object.create(null)){for(const n of Reflect.ownKeys(t))n in e||delete t[n];for(const n of Reflect.ownKeys(e))t[n]=Ae(0,e[n]);return t}const Se=new Set([":","@","#","*","!","%","^","~","&","=","+",".","(",")","[","]","{","}","<",">"]);function De(e){return"string"!=typeof e||!Se.has(e[0])&&(!/^n[:-]/.test(e)&&!/^on[:-]/.test(e))}function Ce(t,n,r={},i=!1,o=!1){const s=Reflect.ownKeys(n),c=new Set(o?s.filter(De):s);for(const e of Reflect.ownKeys(t))c.has(e)||delete t[e];if(!i){for(const e of c)t[e]=n[e];return t}for(const i of c){const o=n[i];i in r&&r[i]===o||(e.isValue(o)?Reflect.defineProperty(t,i,{configurable:!0,enumerable:!0,get:()=>o(),set(e){o(e)}}):Reflect.defineProperty(t,i,{configurable:!0,enumerable:!0,value:o}))}return t}function je(...e){return e.filter(Boolean)}function $e(e,t){if(!e)return null;if("string"!=typeof e)return e;if("template"===e)return e;if(/^neep:.+/i.test(e))return e;for(const n of t){const t=n[e];if(t)return t}return m[e]||e}function Oe(e,t,n,r,i,o=!1){if(Array.isArray(n))return n.map(n=>Oe(e,t,n,r,i,o));if(!X(n))return n;const{inserted:s,args:l=[{}]}=n;let a=$e(n.tag,i);if(a===N){const s={...n.props};delete s.ref,delete s.slot,delete s.key;const c=Object.create(t);return Ce(c,s||{},{},!0),{...n,tag:a,$__neep__delivered:c,children:n.children.map(t=>Oe(e,c,t,r,i,o))}}const d=n.children.map(n=>Oe(e,t,n,r,i,o));return"function"==typeof a?"simple"===a[_]?function(e,t,n,r,i,o){const{iRender:s}=e,l=Object.create(null);Re(s,o,l);const a=ke(l),d=new c;d.updateInProps(n.props);const u=M({slots:a,created:!1,parent:e.exposed,delivered:t,children:new Set,childNodes:o,refresh(t){e.refresh(t)},emit:d.emit}),f=r({...n.props},u,re),h=Oe(e,t,He(s,f,u,r[b]),a,je(...i,r[w]));return{...n,tag:r,children:Array.isArray(h)?h:[h],label:void 0}}(e,t,n,a,i,Oe(e,t,d,r,i,o)):{...n,$__neep__delivered:t,children:d,tag:a}:(a===$&&(a=o?"slot":C),a!==C||s?{...n,children:d,tag:a}:function(e,t,n,r,i,o,s=[{}],c){var l;const a=r[(null===(l=n.props)||void 0===l?void 0:l.name)||"default"];if("function"==typeof a)return{...n,...a(...s)};const{render:d}=n;return{...n,tag:C,label:void 0,children:Oe(e,t,"function"!=typeof d?o:d(...s),r,i,c)}}(e,t,{...n,tag:a},r,i,d,l,o))}function He(e,t,n,r){return Array.isArray(t)?t:X(t)?[t]:null==t?[{[v]:!0,tag:null,children:[]}]:(!e.isNode(t)&&t&&"object"==typeof t&&r&&(t=r(t,n,re)),X(t)?[t]:null==t?[{[v]:!0,tag:null,children:[]}]:[{[v]:!0,tag:O,value:t,children:[]}])}function Ne(e,t){const{component:n}=e;return Oe(e,e.delivered,He(e.iRender,t,e.context,n[b]),e.context.slots,je(n[w]),Boolean(e.native))}let Ee=0;const Pe=new Set;function Ve(e){return!(Ee<=0)&&(Pe.add(e),!0)}function Ie(){if(Ee>0)return;const e=[...Pe];Pe.clear(),e.forEach(e=>e.refresh())}function Te(e,t){if(t)return async function(e){try{return Ee++,await e()}finally{Ee--,Ie()}}(e);try{return Ee++,e()}finally{Ee--,Ie()}}let ze;function Me(e){ze=e}function qe(e){ze?ze.push(e):e()}class Fe{constructor(e,t,n=(null==t?void 0:t.delivered)||Object.create(null),r){i(this,"events",new c),i(this,"emit",this.events.emit),i(this,"on",this.events.on),i(this,"eventCancelHandles",new Set),i(this,"iRender",void 0),i(this,"components",Object.create(null)),i(this,"config",Object.create(null)),i(this,"parentDelivered",void 0),i(this,"delivered",void 0),i(this,"exposed",function(e){const t={$parent:{configurable:!0,get:()=>{var t;return null===(t=e.parent)||void 0===t?void 0:t.exposed}},$component:{configurable:!0,value:null},$isContainer:{configurable:!0,value:!1},$created:{configurable:!0,get:()=>e.created},$destroyed:{configurable:!0,get:()=>e.destroyed},$mounted:{configurable:!0,get:()=>e.mounted},$unmounted:{configurable:!0,get:()=>e.unmounted}};return Object.create(null,t)}(this)),i(this,"entity",function(e){const t={exposed:{configurable:!0,get:()=>e.exposed},delivered:{configurable:!0,get:()=>e.delivered},parent:{configurable:!0,get:()=>{var t;return null===(t=e.parent)||void 0===t?void 0:t.entity}},component:{configurable:!0,value:null},isContainer:{configurable:!0,value:!1},created:{configurable:!0,get:()=>e.created},destroyed:{configurable:!0,get:()=>e.destroyed},mounted:{configurable:!0,get:()=>e.mounted},unmounted:{configurable:!0,get:()=>e.unmounted},$_hooks:{configurable:!0,value:Object.create(null)},$_valueIndex:{configurable:!0,value:0,writable:!0},$_values:{configurable:!0,value:[]},callHook:{configurable:!0,value(e){K(e,n)}},setHook:{configurable:!0,value:(e,t)=>F(e,t,n)},refresh:{configurable:!0,value:e.refresh.bind(e)},on:{configurable:!0,value:e.on},emit:{configurable:!0,value:e.emit},config:{configurable:!0,value:e.config}},n=Object.create(null,t);return n}(this)),i(this,"parent",void 0),i(this,"native",void 0),i(this,"created",!1),i(this,"destroyed",!1),i(this,"mounted",!1),i(this,"unmounted",!1),i(this,"children",new Set),i(this,"tree",[]),i(this,"container",void 0),i(this,"_render",()=>[]),i(this,"_needRefresh",!1),i(this,"_delayedRefresh",0),i(this,"_refreshing",!1),i(this,"_nodes",[]),i(this,"childNodes",[]),i(this,"__executed_destroy",!1),i(this,"__executed_mount",!1),i(this,"__executed_mounted",!1),i(this,"_cancelDrawMonitor",void 0),this.iRender=e,this.parentDelivered=n,this.delivered=Object.create(n),t&&(this.parent=t),this.container=r||this}get canRefresh(){return!Ve(this)&&!this._delayedRefresh}get needRefresh(){if(Ve(this))return!1;if(this._delayedRefresh)return!1;const e=this._needRefresh;return this._needRefresh=!1,e}requestDraw(){}async asyncRefresh(e){try{return this._delayedRefresh++,await e()}finally{this._delayedRefresh--,this.refresh()}}refresh(e,t){if("function"==typeof e){if(t)return this.asyncRefresh(e);try{return this._delayedRefresh++,e()}finally{this._delayedRefresh--,this._delayedRefresh<=0&&this.refresh()}}if(this.destroyed)return;if(this._needRefresh=!0,!this.created)return;if(this._refreshing)return;let n;for(this._refreshing=!0;this.needRefresh;)if(n=this._render(),this.destroyed)return;this._refreshing=!1,this.canRefresh&&n&&(this._nodes=Xe(this,n,this._nodes),this.mounted&&(this.destroyed||this.unmounted||this.requestDraw()))}callHook(e){K(e,this.entity)}_update(e,t){this.childNodes=t}update(e,t){this._update(e,t)}_destroy(){}destroy(){this.__executed_destroy||(this.__executed_destroy=!0,this.callHook("beforeDestroy"),this._destroy(),this.callHook("destroyed"),this.destroyed=!0)}_mount(){}mount(){if(this.__executed_destroy)return;if(this.__executed_mount)return;this.__executed_mount=!0,this.callHook("beforeMount");const e=a.exec(e=>e&&this.requestDraw(),()=>{this._mount(),this.mounted=!0});this._cancelDrawMonitor=e.stop,qe(()=>this.callHook("mounted"))}_unmount(){}unmount(){this.mounted&&(this.__executed_mounted||(this.__executed_mounted=!0,this.callHook("beforeUnmount"),this._unmount(),this.callHook("unmounted"),this.unmounted=!0))}_draw(){}draw(){var e;if(this.__executed_destroy)return;null===(e=this._cancelDrawMonitor)||void 0===e||e.call(this),this.callHook("beforeUpdate");const t=a.exec(e=>e&&this.requestDraw(),()=>this._draw());this._cancelDrawMonitor=t.stop,qe(()=>this.callHook("updated"))}}function Ke(e,t,n){Ce(e.props,t,{},!1,!0),e.events.updateInProps(t);const r=Object.create(null),{native:i}=e,o=Re(e.iRender,n,r,Boolean(i));ke(r,e.slots),i&&(e.nativeNodes=Xe(e,o,e.nativeNodes),e.mounted&&e.requestDraw())}class Be extends Fe{constructor(e,t,n,r,o){var s,c;super(r.iRender,r,o,r.container),i(this,"component",void 0),i(this,"props",a.encase(Object.create(null))),i(this,"slots",a.encase(Object.create(null))),i(this,"_stopRender",void 0),i(this,"nativeNodes",void 0),i(this,"shadowTree",[]),i(this,"nativeTree",[]),i(this,"_shadow",void 0),i(this,"context",void 0),i(this,"parent",void 0),this.component=e,Object.assign(this.config,e[R]),Object.assign(this.components,e[w]),Reflect.defineProperty(this.exposed,"$component",{value:e,enumerable:!0,configurable:!0}),[this.native,this._shadow]="native"===e[_]&&(null===(s=(c=this.iRender).component)||void 0===s?void 0:s.call(c))||[],this.parent=r,r.children.add(this.exposed);const l=M({slots:(d=this).slots,get created(){return d.created},get parent(){return d.parent.exposed},get delivered(){return d.parentDelivered},get children(){return d.children},get childNodes(){return d.childNodes},get emit(){return d.emit},refresh(e){d.refresh(e)}},d.exposed);var d;this.context=l,this.callHook("beforeCreate"),this.childNodes=n,Te(()=>Ke(this,t,n));const{render:u,nodes:f,stopRender:h}=function(e){const{component:t,props:n,context:r,entity:i}=e,o=t=>t&&e.refresh(),s=a.exec(o,()=>I(()=>t(n,r,re),i),{resultOnly:!0});if("function"==typeof s){const t=a.createExecutable(o,()=>Ne(e,s()));return{nodes:t(),render:t,stopRender:()=>t.stop()}}const c=a.createExecutable(o,()=>Ne(e,I(()=>t(n,r,re),i)));return{nodes:a.exec(o,()=>Ne(e,s),{resultOnly:!0}),render:c,stopRender:()=>c.stop()}}(this);this._render=u,this._stopRender=h,this._nodes=Xe(this,f),this.callHook("created"),this.created=!0,this._needRefresh&&this.refresh()}_update(e,t){this.destroyed||(this.childNodes=t,Te(()=>Ke(this,e,t)))}_destroy(){this._stopRender&&this._stopRender(),this.parent.children.delete(this.exposed),Le(this._nodes)}requestDraw(){this.container.markDraw(this)}_draw(){const{nativeNodes:e,iRender:t,_shadow:n,native:r}=this;r&&e&&n?(this.shadowTree=we(t,this._nodes,this.shadowTree),this.nativeTree=we(t,e,this.nativeTree)):this.tree=we(t,this._nodes,this.tree)}_mount(){const{nativeNodes:e,iRender:t,_shadow:n,native:r,_nodes:i}=this;if(r&&e&&n){this.tree=we(t,Xe(this,r)),this.shadowTree=we(t,i);for(const e of ue(this.shadowTree))t.insert(n,e);this.nativeTree=we(t,e);for(const e of ue(this.nativeTree))t.insert(r,e)}else this.tree=we(t,i)}_unmount(){const{iRender:e,nativeTree:t}=this;fe(e,this.tree),t&&fe(e,t)}}function Ue(e){return!1===e||null==e?null:X(e)?e:{[v]:!0,tag:O,key:e,value:e,children:[]}}function Le(e){if(Array.isArray(e))return void e.forEach(e=>Le(e));const{component:t}=e;t&&t.destroy()}function Ge(e,t){if(!t)return{tag:null,children:[]};const{tag:n}=t;if(!n)return{tag:null,children:[]};if("string"!=typeof n)return"simple"===n[_]?{...t,children:Xe(e,t.children),component:void 0}:{...t,children:[],component:new Be(n,t.props||{},t.children,e,t.$__neep__delivered)};if(n===H){var r;const n=null==t?void 0:null===(r=t.props)||void 0===r?void 0:r.type,i=n?h(n):e.iRender;return{...t,children:[],component:new et(i,t.props||{},t.children,e,t.$__neep__delivered)}}return n===O?{...t,children:[]}:(n===E||n.substr(0,5),{...t,children:Xe(e,t.children)})}function Je(e,t,n){Array.isArray(n)||(n=[n]);const r=[];for(const i of oe(t)){const t=Ue(i);if(!t)continue;const o=n.findIndex(e=>e.tag===t.tag&&e.key===t.key);o>=0?(r.push(Qe(e,t,n[o])),n.splice(o,1)):r.push(Ge(e,t))}return Le(n),r}function Qe(e,t,n){if(!n)return Ge(e,t);if(!t)return Le(n),{tag:null,children:[]};if(Array.isArray(n)){if(!n.length)return Ge(e,t);const r=n.findIndex(e=>e.tag===t.tag);if(r<0)return Le(n),Ge(e,t);const i=n;[n]=n.splice(r,1),Le(i)}const{tag:r}=t;if(r!==n.tag)return Le(n),Ge(e,t);if(!r)return{tag:null,children:[]};if("string"!=typeof r){if("simple"===r[_])return{...t,children:Xe(e,t.children,n.children),component:void 0};const{component:i}=n;return i?(i.update(t.props||{},t.children),{...t,children:[],component:i}):Ge(e,t)}if(r===H){var i;const{component:r}=n;if(!r)return Ge(e,t);const o=null==t?void 0:null===(i=t.props)||void 0===i?void 0:i.type;return(o?h(o):e.iRender)!==r.iRender?Ge(e,t):(r.update(t.props||{},t.children),{...t,children:[],component:r})}if(r===O)return{...t,children:[]};if(r===E||"Neep:"===r.substr(0,5)){let i;if(N===r){const e={...t.props};delete e.ref,delete e.slot,delete e.key,i=Ce(n.$__neep__delivered,e,n.props,!0)}return{...t,$__neep__delivered:i,children:Xe(e,t.children,n.children)}}return{...t,children:Xe(e,t.children,n.children)}}function*We(e,t,n){let r=0,i=Math.min(t.length,t.length);for(;r<i;r++){const i=t[r];Array.isArray(i)?yield Je(e,i,n[r]):yield Qe(e,Ue(i),n[r])}if(i=Math.max(t.length,t.length),n.length>i)for(;r<i;r++)Le(n[r]);if(t.length>i)for(;r<i;r++){const n=Ue(t[r]);Array.isArray(n)?yield[...oe(n)].map(t=>Ge(e,t)):yield Ge(e,n)}}function Xe(e,t,n){return Array.isArray(t)||(t=[t]),n?[...We(e,t,n)]:function(e,t){return t.length?t.map(t=>Array.isArray(t)?[...oe(t)].map(t=>Ge(e,Ue(t))):Ge(e,Ue(t))):[]}(e,t)}let Ye=new Set,Ze=!1;class et extends Fe{constructor(e,t,n,r,o){super(e,r,o),i(this,"props",void 0),i(this,"content",[]),i(this,"_node",null),i(this,"_container",null),i(this,"rootContainer",this),i(this,"_drawChildren",!1),i(this,"_drawContainer",!1),i(this,"_awaitDraw",new Set),i(this,"_needDraw",!1),i(this,"_containers",new Set),this.props=t,this.parent=r,r&&(this.rootContainer=r.container.rootContainer),this.callHook("beforeCreate"),this._render=()=>n,this._nodes=Xe(this,n),this.callHook("created"),this.created=!0}setChildren(e){this.destroyed||(this.childNodes=e,this._render=()=>e,this._drawChildren=!0,this.refresh())}setProps(e){this.destroyed||(this.props=e,this._drawContainer=!0,this.refresh())}update(e,t){this.refresh(()=>{this.setProps(e),this.setChildren(t)})}requestDraw(){this.markDraw(this)}_mount(){const{props:e,parent:t,iRender:n}=this,r=we(this.container.iRender,this._nodes);this.content=r;const[i,o]=n.mount(e,null==t?void 0:t.iRender);for(const e of ue(r))n.insert(i,e);this.tree=[ie({tag:O,component:void 0,node:o,value:o,children:[]})],this._node=o,this._container=i}_destroy(){Le(this.content)}_unmount(){const{parent:e,iRender:t}=this;e&&fe(e.iRender,this.tree),t.unmount(this._container,this._node,Boolean(e)),fe(this.iRender,this.content)}_draw(){const{_drawChildren:e,_drawContainer:t}=this;var n;(this._drawContainer=!1,t)&&this.iRender.drawContainer(this._container,this._node,this.props,null===(n=this.parent)||void 0===n?void 0:n.iRender);this.parent&&this.parent.iRender!==this.iRender||(this._drawChildren=!1,e&&(this.content=we(this.iRender,this._nodes,this.content)))}_drawSelf(){const{_drawChildren:e,_drawContainer:t}=this;var n;(this._needDraw=!1,this._drawChildren=!1,this._drawContainer=!1,t)&&this.iRender.drawContainer(this._container,this._node,this.props,null===(n=this.parent)||void 0===n?void 0:n.iRender,!0);e&&(this.content=we(this.iRender,this._nodes,this.content))}drawSelf(){this.mounted&&(this.destroyed||(this.callHook("beforeUpdate"),a.exec(e=>e&&this.markDraw(this),()=>this._drawSelf()),qe(()=>this.callHook("updated"))))}markDraw(e,t=!1){var n;(null===(n=this.parent)||void 0===n?void 0:n.iRender)!==this.iRender?(e===this&&this.parent?(this.parent.container.markDraw(this,t),this._needDraw=!t):t?this._awaitDraw.delete(e):this._awaitDraw.add(e),this.rootContainer.markDrawContainer(this,!this._needDraw&&!this._awaitDraw.size||this.destroyed)):this.parent.container.markDraw(e,t)}drawContainer(){const{_node:e,_container:t,_awaitDraw:n}=this;if(!e||!t)return;this.callHook("beforeDraw");const r=this._needDraw;this._needDraw=!1;const i=[...n];n.clear(),r&&this.drawSelf(),i.map(e=>e.draw()),this.iRender.draw(t,e),qe(()=>this.callHook("drawn"))}markDrawContainer(e,t=!1){var n;t?this._containers.delete(e):this._containers.add(e),n=this,Ye.add(n),Ze||(Ze=!0,u(()=>{Ze=!1;const e=[...Ye];Ye.clear(),e.map(e=>e.drawAll())}))}drawAll(){const e=this._containers;if(!e.size)return;this.callHook("beforeDrawAll");const t=[],n=[];Me(n),ce(t);const r=[...e];e.clear(),r.forEach(e=>e.drawContainer()),ce(),t.forEach(e=>e()),n.forEach(e=>e()),this.callHook("drawnAll")}}y({monitorable:t}),e.Container=H,e.Deliver=N,e.Error=l,e.EventEmitter=c,e.Fragment=P,e.ScopeSlot=C,e.Slot=$,e.SlotRender=j,e.Tags=V,e.Template=E,e.Value=O,e.addContextConstructor=function(e){z.push(a.safeify(e))},e.callHook=K,e.checkCurrent=T,e.componentsSymbol=w,e.configSymbol=R,e.create=function(e,t){return"function"==typeof t&&(e[b]=t),e},e.createElement=Y,e.defineAuxiliary=function(e,t){Reflect.defineProperty(re,e,{get:t,enumerable:!0,configurable:!0})},e.deliver=Q,e.elements=Z,e.expose=J,e.hook=L,e.install=y,e.isElement=X,e.isElementSymbol=v,e.isProduction=!0,e.label=te,e.lazy=function(t,n){const r=e.value(0),i=e.value(void 0);return D((function(e,{childNodes:o},{createElement:s}){const c=i();return c?s(c,e,...o):(async function(){if(!r()){r(1);try{const e=await t();if("function"==typeof e)return void i(e);if(!e)return void r(-1);if("function"==typeof e.default)return void i(e.default);r(-1)}catch(e){r(-1)}}}(),n?s(n,{loading:r()>0}):null)}),S,k("Lazy"))},e.mComponent=function(e,t,n){const r=A(w,e,t);return n?r(n):r},e.mConfig=function(e,t,n){const r=A(R,e,t);return n?r(n):r},e.mName=k,e.mNative=function(e){return e?(e[_]="native",e):x(_,"native")},e.mRender=function(e,t){return t?(t[b]=e,t):x(b,e)},e.mSimple=S,e.mType=function(e,t){return t?(t[_]=e,t):x(_,e)},e.mark=D,e.mode=n,e.nameSymbol=g,e.refresh=Te,e.register=function(e,t){m[e]=t},e.render=function(e,t={}){let n={...t};const r=new et(h(t.type),n,void 0===e?[]:X(e)?[e]:[Y(e)]),{exposed:i}=r;return Reflect.defineProperty(i,"$update",{value:e=>(r.setChildren(void 0===e?[]:X(e)?[e]:[Y(e)]),i),configurable:!0}),Reflect.defineProperty(i,"$mount",{value:e=>i.$mounted?i:(e&&(n.target=e,r.setProps(n)),r.mount(),i),configurable:!0}),Reflect.defineProperty(i,"$unmount",{value(){if(i.$mounted&&!i.$unmounted)return i.$destroyed?r.destroy():void r.unmount()},configurable:!0}),n.target&&r.mount(),i},e.renderSymbol=b,e.setAuxiliary=function(e,t){Reflect.defineProperty(re,e,{value:t,enumerable:!0,configurable:!0})},e.setHook=F,e.typeSymbol=_,e.useValue=U,e.version="undefined",e.watch=B,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=neep.core.min.js.map
