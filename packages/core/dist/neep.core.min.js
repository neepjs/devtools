/*!
 * Neep v0.1.0-alpha.4
 * (c) 2019-2020 Fierflame
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("monitorable")):"function"==typeof define&&define.amd?define(["exports","monitorable"],t):t((e=e||self).Neep={},e.Monitorable)}(this,(function(e,t){"use strict";const n="production";var r=Object.freeze({__proto__:null,version:"undefined",mode:n,isProduction:!0});function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class i extends Error{constructor(e,t=""){super(t?`[${t}] ${e}`:e),o(this,"tag",void 0),this.tag=t}}let s,c;function l(e){!function(e,t,n){if(!e)throw new i(t,n)}(c,"The basic renderer is not installed","install"),c(e)}const d=Object.create(null);function a(e=""){return"object"==typeof e?e:d[e]||d.default}function u(e){e&&(d[e.type]=e,c||(d.default||(d.default=e),!c&&e.nextFrame&&(d.default=e,c=e.nextFrame)))}function h(t){var n;(n=t.monitorable)&&(s=n,e.value=s.value,e.computed=s.computed,e.isValue=s.isValue,e.encase=s.encase,e.recover=s.recover),function({render:e,renders:t}){if(u(e),Array.isArray(t))for(const e of t)u(e)}(t)}const f="Neep:ScopeSlot",p="Neep:SlotRender",y="Neep:Slot",_="Neep:Value",m="Neep:Container",v="Neep:Deliver",g="template",b=g;var w=Object.freeze({__proto__:null,ScopeSlot:f,SlotRender:p,Slot:y,Value:_,Container:m,Deliver:v,Template:g,Fragment:b});function x(t,n){const r=e.current;e.current=n;try{e.current.$_valueIndex=0;const n=t();if(e.current.$_valueIndex!==e.current.$_values.length)throw new i("Inconsistent number of useValue executions","life");return n}finally{e.current=r}}function R(t,n=!1){if(!e.current)throw new i(`Function \`${t}\` can only be called within a cycle.`,"life");if(!n)return e.current;if(!e.current.created)return e.current;throw new i(`Function \`${t}\` can only be called at initialization time.`,"life")}const A=[];function k(e,t){for(const n of A)n(e,t);return e}const $=Object.create(null);function S(e,t,n){let r=(null==n?void 0:n.$_hooks)||$;if(!r)return()=>{};t=s.safeify(t);let o=r[e];return o||(o=new Set,r[e]=o),o.add(t),()=>o.delete(t)}function D(e,t){if(t){for(const n of t.$_hooks[e]||[])n(t);for(const n of $[e]||[])n(t)}}function C(t,n){const r=R("watch");if("function"!=typeof t)return()=>{};const o=e.isValue(t)?t.watch(n):e.computed(t).watch((e,t)=>n(e(),t));return S("beforeDestroy",()=>o(),r),o}function N(t,n="useValue"){const r=R(n),o=r.$_valueIndex++,s=r.$_values;if(!r.created){s[o]=void 0;const n="function"==typeof t?t():e.value(void 0);return s[o]=n}if(o>=s.length)throw new i("Inconsistent number of useValue executions","life");return s[o]}function j(e,t,n){const r=R("setHook");if(!n||!r.created)return S(e,()=>t(),r)}function H(t,n,r,o){"string"==typeof n&&["$","_"].includes(n[0])||(e.isValue(r)&&o?Reflect.defineProperty(t,n,{get:()=>r(),set(e){r(e)},configurable:!0,enumerable:!0}):"function"==typeof r&&o?Reflect.defineProperty(t,n,{get:r,set:"function"==typeof o?o:void 0,configurable:!0,enumerable:!0}):Reflect.defineProperty(t,n,{get:()=>r,configurable:!0,enumerable:!0}))}function O(e,t,n){H(R("expose",!0).exposed,e,t,n)}function V(e,t,n){H(R("deliver",!0).delivered,e,t,n)}var P=Object.freeze({__proto__:null,watch:C,useValue:N,hook:j,setValue:H,expose:O,deliver:V});const T=Symbol.for("isNeepElement"),E=Symbol.for("type"),z=Symbol.for("name"),I=Symbol.for("render");function M(e){return!!e&&("object"==typeof e&&!0===e[T])}function F(e,t,...n){t=t?{...t}:{};const r={[T]:!0,tag:e,children:[]};if("key"in t&&(r.key=t.key),"slot"in t&&(r.slot=t.slot),"function"==typeof t.ref&&(r.ref=t.ref),e===_)return r.value=t.value,r;if(r.children=n,e===g)return r;if(e===p)return r.render=t.render,r;if(e===f||e===y){const{render:n,argv:o,args:i,name:s}=t;if(r.render=n,r.args=o&&[o]||Array.isArray(i)&&i.length&&i||[{}],e===f)return r.props={name:s},r}r.on={},r.props={};for(let e in t){const n=/^(::|@|on:)([a-zA-Z0-9].*)$/.exec(e);n?r.on[n[2]]=t[e]:/^n([:-])([a-zA-Z0-9]+(?:\.[a-zA-Z0-9]+)*)$/i.exec(e)||(r.props[e]=t[e])}return r}function K(e,t={}){if(Array.isArray(e)){const n=[];for(let r of e)n.push(K(r,t));return[].concat(...n)}if(!M(e))return[e];let{tag:n}=e;if(!n)return[];if([g,f].includes(n))return K(e.children,t);if("function"!=typeof n)return[e];if("simple"!==n[E])return[e];const{simple:r}=t;if(!r)return[e];if(Array.isArray(r)){if(r.includes(n))return[e]}else if("function"==typeof r&&!r(n))return[e];return K(e.children,t)}var B=Object.freeze({__proto__:null,isElement:M,createElement:F,elements:K});function U(e,t=""){}var Z=Object.freeze({__proto__:null,label:U});const q={...w,...P,...B,...Z,...r,get value(){return e.value},get computed(){return e.computed},get isValue(){return e.isValue},get encase(){return e.encase},get recover(){return e.recover}};function G(e,t){return{...e,id:0}}function*J(e){if(Array.isArray(e))for(const t of e)yield*J(t);else yield e}function L(e){if(Array.isArray(e))return L(e[e.length-1]);const{component:t,children:n,node:r}=e;return r||L(t?t.tree:n)}function Q(e){if(Array.isArray(e))return Q(e[0]);const{component:t,children:n,node:r}=e;return r||Q(t?t.tree:n[0])}function*W(e){if(Array.isArray(e)){for(const t of e)yield*W(t);return}const{children:t,node:n,component:r}=e;n?yield n:r?yield*W(r.tree):yield*W(t)}function X(e,t){if(Array.isArray(t))return void t.forEach(t=>X(e,t));const{component:n,children:r,node:o,ref:i}=t;return o?(i&&i(o,!0),void e.remove(o)):n?(i&&i(n.exposed,!0),void n.unmount()):void X(e,r)}function Y(e,t,n){const r=Q(n);if(!r)return t;const o=e.parent(r);if(!o)return t;for(const n of W(t))e.insert(o,n,r);return X(e,n),t}function ee(e,t,n){if(!t.length){return[Y(e,se(e,{tag:null,children:[]}),n)]}Array.isArray(n)||(n=[n]);const r=[],o=[...n],i=new Map;for(const n of t){const t=o.findIndex(e=>e.tag===n.tag&&e.key===n.key);if(t>=0){const s=o[t],c=ne(e,n,s);i.set(s,c),r.push(c),o.splice(t,1)}else{const t=se(e,n);r.push(t)}}if(!i.size)return Y(e,r,o);X(e,o);const s=L((n=n.filter(e=>i.has(e)))[n.length-1]),c=e.parent(s);if(!c)return r;let l=e.next(s);for(let t=r.length-1;t>=0;t--){const o=r[t],s=n.findIndex(e=>i.get(e)===o);if(s>=0)for(const e of n.splice(s))i.delete(e);else for(const t of W(o))e.insert(c,t,l);l=Q(o)||l}return r}function te(e,t,n){let r=0,o=Math.min(t.length,t.length||1);const i=[];for(;r<o;r++){const o=t[r];Array.isArray(o)?i.push(ee(e,o,n[r])):i.push(ne(e,o,n[r]))}if(o=Math.max(t.length,n.length),n.length>o)for(;r<o;r++)X(e,n[r]);if(t.length>o){const n=L(i[i.length-1]),s=e.parent(n),c=e.next(n);for(;r<o;r++){const n=t[r],o=Array.isArray(n)?ie(e,n):se(e,n);if(i.push(o),s)for(const t of W(o))e.insert(s,t,c)}}return i}function ne(t,n,r){if(Array.isArray(r)){const e=r.findIndex(e=>e.tag===n.tag&&e.component===n.component);if(e<0)return Y(t,se(t,n),r);const o=r;[r]=r.splice(e,1),X(t,o)}const{tag:o,component:i}=n,s=n.ref!==r.ref&&n.ref;if(o!==r.tag||i!==r.component)return Y(t,se(t,n),r);if(!o)return r;if("string"!=typeof o||o===m)return i?(s&&s(i.exposed),G({...n,node:void 0,component:i,children:[]},r.id)):G({...n,node:void 0,component:void 0,children:ce(t,n.children,r.children)},r.id);if(o===_){let o=n.value;return e.isValue(o)&&(o=o()),r.value===o?(s&&r.node&&s(r.node),G({...r,...n,value:o,children:[]},r.id)):Y(t,re(t,n,o),r)}if(o===g||"Neep:"===o.substr(0,5))return G({...n,node:void 0,component:void 0,children:te(t,n.children,r.children)},r.id);const{node:c}=r;if(t.update(c,n.props||{},e.isValue),s&&s(c),!n.children.length&&!r.children.length)return G({...r,...n,children:[]},r.id);if(!n.children.length&&r.children.length&&X(t,r.children),n.children.length&&!r.children.length){const e=oe(t,n.children);for(const n of W(e))t.insert(c,n);return G({...r,...n,children:e},r.id)}return G({...r,...n,children:te(t,n.children,r.children)},r.id)}function re(e,t,n){let{ref:r}=t;if(e.isNode(n))return r&&r(n),G({...t,value:n,node:n,children:[],component:void 0});const o=typeof n;let i;return"bigint"===o||"boolean"===o||"number"===o||"string"===o||"symbol"===o||n instanceof RegExp?i=e.text(String(n)):n instanceof Date?i=e.text(n.toISOString()):"object"===o&&n&&(i=e.text(String(n))),i||(i=e.placeholder()),r&&r(i),G({...t,value:n,node:i,component:void 0,children:[]})}function oe(e,t){return t.length?t.map(t=>Array.isArray(t)?ie(e,t):se(e,t)):[G({tag:null,node:e.placeholder(),component:void 0,children:[]})]}function ie(e,t){return t.length?t.map(t=>se(e,t)):[G({tag:null,node:e.placeholder(),component:void 0,children:[]})]}function se(t,n){const{tag:r,ref:o,component:i}=n;if(!r){const e=t.placeholder();return o&&o(e),G({tag:null,node:e,component:void 0,children:[]})}if("string"!=typeof r||r===m)return i?(i.mount(),o&&o(i.exposed),G({...n,node:void 0,component:i,children:[]})):G({...n,node:void 0,component:void 0,children:ce(t,n.children)});if(r===_)return re(t,n,n.value);if(r===g||"Neep:"===r.substr(0,5))return G({...n,node:void 0,component:void 0,children:oe(t,n.children)});const s=t.create(r,n.props||{},e.isValue);o&&o(s);let c=[];if(n.children){c=oe(t,n.children);for(const e of W(c))t.insert(s,e)}return G({...n,node:s,component:void 0,children:c})}function ce(e,t,n){return n?te(e,t,n):oe(e,t)}function le(e,t,n,r=!1){const o=[];for(const i of t){if(Array.isArray(i)){const t=Object.create(null);o.push(le(e,i,t,r));for(const e of Reflect.ownKeys(t))e in n?n[e].push(t[e]):n[e]=[t[e]];continue}if(r){if(e.isNode(i)){o.push(i);continue}if(!M(i)){o.push(i);continue}if(i.tag!==p){o.push(i);continue}}const t=M(i)&&i.slot||"default",s=M(i)?{...i,slot:void 0,props:{...i.props,slot:void 0}}:i;t in n?n[t].push(s):n[t]=[s]}return o}function de(e,...t){return e.map(e=>Array.isArray(e)?de(e,...t):M(e)?e.tag!==p?{...e,slot:void 0}:"function"==typeof e.render?e.render(...t):e.children:e)}function ae(e,t){const n=(...e)=>({[T]:!0,tag:f,children:de(t,...e),inserted:!0,label:void 0});return n.children=t,n}function ue(e,t=Object.create(null)){for(const n of Reflect.ownKeys(t))n in e||delete t[n];for(const n of Reflect.ownKeys(e))t[n]=ae(0,e[n]);return t}function he(t,n,r={},o=!1){const i=new Set(Reflect.ownKeys(n));for(const e of Reflect.ownKeys(t))i.has(e)||delete t[e];if(!o){for(const e of i)t[e]=n[e];return t}for(const o of i){const i=n[o];o in r&&r[o]===i||(e.isValue(i)?Reflect.defineProperty(t,o,{configurable:!0,enumerable:!0,get:()=>i(),set(e){i(e)}}):Reflect.defineProperty(t,o,{configurable:!0,enumerable:!0,value:i}))}return t}function fe(e,t,n,r,o=!1){if(Array.isArray(n))return n.map(n=>fe(e,t,n,r,o));if(!M(n))return n;let{tag:i,inserted:s,args:c=[{}]}=n;if(i===v){const s={...n.props};delete s.ref,delete s.slot,delete s.key;const c=Object.create(t);return he(c,s||{},{},!0),{...n,tag:i,$__neep__delivered:c,children:n.children.map(t=>fe(e,c,t,r,o))}}const l=n.children.map(n=>fe(e,t,n,r,o));return"function"==typeof i?"simple"===i[E]?function(e,t,n,r,o){const{iRender:i}=e.container,s=Object.create(null);le(i,o,s);const c=ue(s),l=k({slots:c,created:!1,parent:e.exposed,delivered:t,children:new Set,childNodes:o,refresh(t){e.refresh(t)}}),d=r({...n.props},l,q),a=fe(e,t,pe(i,d,l,r[I]),c);return{...n,children:Array.isArray(a)?a:[a],label:void 0}}(e,t,n,i,l):{...n,$__neep__delivered:t,children:l,tag:i}:(i===y&&(i=o?"slot":f),i!==f||s?{...n,children:l,tag:i}:function(e,t,n,r=[{}]){var o;const i=t[(null===(o=e.props)||void 0===o?void 0:o.name)||"default"];if("function"==typeof i)return{...e,...i(...r)};const{render:s}=e;return{...e,tag:f,label:void 0,children:"function"!=typeof s?n:s(...r)}}(n,r,l,c))}function pe(e,t,n,r){return Array.isArray(t)?t:M(t)?[t]:null==t?[{[T]:!0,tag:null,children:[]}]:(!e.isNode(t)&&"object"==typeof t&&r&&(t=r(t,n,q)),M(t)?[t]:null==t?[{[T]:!0,tag:null,children:[]}]:[{[T]:!0,tag:_,value:t,children:[]}])}function ye(e,t){return fe(e,e.delivered,pe(e.iRender,t,e.context,e.component[I]),e.context.slots,Boolean(e.native))}let _e=0;const me=new Set;function ve(e){return!(_e<=0)&&(me.add(e),!0)}function ge(){if(_e>0)return;const e=[...me];me.clear(),e.forEach(e=>e.refresh())}class be{constructor(e,t,n=(null==t?void 0:t.delivered)||Object.create(null),r){o(this,"iRender",void 0),o(this,"parentDelivered",void 0),o(this,"delivered",void 0),o(this,"exposed",function(e){const t={$parent:{configurable:!0,get:()=>{var t;return null===(t=e.parent)||void 0===t?void 0:t.exposed}},$component:{configurable:!0,value:null},$isContainer:{configurable:!0,value:!1},$created:{configurable:!0,get:()=>e.created},$destroyed:{configurable:!0,get:()=>e.destroyed},$mounted:{configurable:!0,get:()=>e.mounted},$unmounted:{configurable:!0,get:()=>e.unmounted}};return Object.create(null,t)}(this)),o(this,"entity",function(e){const t={exposed:{configurable:!0,get:()=>e.exposed},delivered:{configurable:!0,get:()=>e.delivered},parent:{configurable:!0,get:()=>{var t;return null===(t=e.parent)||void 0===t?void 0:t.entity}},component:{configurable:!0,value:null},isContainer:{configurable:!0,value:!1},created:{configurable:!0,get:()=>e.created},destroyed:{configurable:!0,get:()=>e.destroyed},mounted:{configurable:!0,get:()=>e.mounted},unmounted:{configurable:!0,get:()=>e.unmounted},$_hooks:{configurable:!0,value:Object.create(null)},$_valueIndex:{configurable:!0,value:0,writable:!0},$_values:{configurable:!0,value:[]},callHook:{configurable:!0,value(e){D(e,n)}},setHook:{configurable:!0,value:(e,t)=>S(e,t,n)},refresh:{configurable:!0,value:e.refresh.bind(e)}},n=Object.create(null,t);return n}(this)),o(this,"parent",void 0),o(this,"native",void 0),o(this,"created",!1),o(this,"destroyed",!1),o(this,"mounted",!1),o(this,"unmounted",!1),o(this,"children",new Set),o(this,"tree",[]),o(this,"container",void 0),o(this,"_render",()=>[]),o(this,"_needRefresh",!1),o(this,"_delayedRefresh",0),o(this,"_refreshing",!1),o(this,"_nodes",[]),o(this,"childNodes",[]),o(this,"__executed_destroy",!1),o(this,"__executed_mount",!1),o(this,"__executed_mounted",!1),o(this,"_cancelDrawMonitor",void 0),this.iRender=e,this.parentDelivered=n,this.delivered=Object.create(n),t&&(this.parent=t),this.container=r||this}get canRefresh(){return!ve(this)&&!this._delayedRefresh}get needRefresh(){if(ve(this))return!1;if(this._delayedRefresh)return!1;const e=this._needRefresh;return this._needRefresh=!1,e}_refresh(){}async asyncRefresh(e){try{return this._delayedRefresh++,await e()}finally{this._delayedRefresh--,this.refresh()}}refresh(e,t){if("function"==typeof e){if(t)return this.asyncRefresh(e);try{return this._delayedRefresh++,e()}finally{this._delayedRefresh--,this._delayedRefresh<=0&&this.refresh()}}if(this.destroyed)return;if(this._needRefresh=!0,!this.created)return;if(this._refreshing)return;let n;for(this._refreshing=!0;this.needRefresh;)if(n=this._render(),this.destroyed)return;this._refreshing=!1,this.canRefresh&&n&&(this._nodes=Ce(this,n,this._nodes),this.mounted&&(this.destroyed||this.unmounted||this._refresh()))}callHook(e){D(e,this.entity)}_update(e,t){this.childNodes=t}update(e,t){this._update(e,t)}_destroy(){}destroy(){this.__executed_destroy||(this.__executed_destroy=!0,this.callHook("beforeDestroy"),this._destroy(),this.callHook("destroyed"),this.destroyed=!0)}_mount(){}mount(){if(this.__executed_destroy)return;if(this.__executed_mount)return;this.__executed_mount=!0;const e=s.exec(()=>{this.callHook("beforeMount"),this._mount(),this.callHook("mounted"),this.mounted=!0},()=>this.container.markDraw(this),{postpone:!0});this._cancelDrawMonitor=e.stop}_unmount(){}unmount(){this.mounted&&(this.__executed_mounted||(this.__executed_mounted=!0,this.callHook("beforeUnmount"),this._unmount(),this.callHook("unmounted"),this.unmounted=!0))}_draw(){}draw(){var e;if(this.__executed_destroy)return;null===(e=this._cancelDrawMonitor)||void 0===e||e.call(this);const t=s.exec(()=>{this.callHook("beforeUpdate"),this._draw(),this.callHook("updated")},()=>this.container.markDraw(this),{postpone:!0});this._cancelDrawMonitor=t.stop}}function we(e,t,n){he(e.props,t);const r=Object.create(null),{native:o,iRender:i}=e,s=le(i,n,r,Boolean(o));ue(r,e.slots),o&&(e.nativeNodes=Ce(e,s,e.nativeNodes),e.mounted&&e.container.markDraw(e))}class xe extends be{constructor(e,t,n,r,i){var c,l;super(r.iRender,r,i,r.container),o(this,"component",void 0),o(this,"props",s.encase(Object.create(null))),o(this,"slots",s.encase(Object.create(null))),o(this,"_stopRender",void 0),o(this,"nativeNodes",void 0),o(this,"shadowTree",[]),o(this,"nativeTree",[]),o(this,"_shadow",void 0),o(this,"context",void 0),o(this,"parent",void 0),this.component=e,Reflect.defineProperty(this.exposed,"$component",{value:e,enumerable:!0,configurable:!0}),[this.native,this._shadow]="native"===e[E]&&(null===(c=(l=this.iRender).component)||void 0===c?void 0:c.call(l))||[],this.parent=r,r.children.add(this.exposed);const d=k({slots:(a=this).slots,get created(){return a.created},get parent(){return a.parent.exposed},get delivered(){return a.parentDelivered},get children(){return a.children},get childNodes(){return a.childNodes},refresh(e){a.refresh(e)}},a.exposed);var a;this.context=d,this.callHook("beforeCreate"),this.childNodes=n,we(this,t,n);const{render:u,nodes:h,stopRender:f}=function(e){const{component:t,props:n,context:r,entity:o}=e,i=t=>t&&e.refresh(),c=s.exec(()=>x(()=>t(n,r,q),o),i,{resultOnly:!0,postpone:!0});if("function"==typeof c){const t=s.createExecutable(()=>ye(e,c()),i);return{nodes:t(),render:t,stopRender:()=>t.stop()}}const l=s.createExecutable(()=>ye(e,x(()=>t(n,r,q),o)),i,{postpone:!0});return{nodes:s.exec(()=>ye(e,c),i,{resultOnly:!0,postpone:!0}),render:l,stopRender:()=>l.stop()}}(this);this._render=u,this._stopRender=f,this._nodes=Ce(this,h),this.callHook("created"),this.created=!0,this._needRefresh&&this.refresh()}_update(e,t){this.destroyed||(this.childNodes=t,we(this,e,t))}_destroy(){this._stopRender&&this._stopRender(),this.parent.children.delete(this.exposed),Ae(this._nodes)}_refresh(){this.container.markDraw(this)}_draw(){const{nativeNodes:e,iRender:t,_shadow:n,native:r}=this;r&&e&&n?(this.shadowTree=ce(t,this._nodes,this.shadowTree),console.log(e),this.nativeTree=ce(t,e,this.nativeTree)):this.tree=ce(t,this._nodes,this.tree)}_mount(){const{nativeNodes:e,iRender:t,_shadow:n,native:r,_nodes:o}=this;if(r&&e&&n){this.tree=ce(t,Ce(this,r)),this.shadowTree=ce(t,o);for(const e of W(this.shadowTree))t.insert(n,e);this.nativeTree=ce(t,e);for(const e of W(this.nativeTree))t.insert(r,e)}else this.tree=ce(t,o)}_unmount(){const{iRender:e,nativeTree:t}=this;X(e,this.tree),t&&X(e,t)}}function Re(e){return!1===e||null==e?null:M(e)?e:{[T]:!0,tag:_,key:e,value:e,children:[]}}function Ae(e){if(Array.isArray(e))return void e.forEach(e=>Ae(e));const{component:t}=e;t&&t.destroy()}function ke(e,t){if(!t)return{tag:null,children:[]};const{tag:n}=t;if(!n)return{tag:null,children:[]};if("string"!=typeof n)return"simple"===n[E]?{...t,children:Ce(e,t.children),component:void 0}:{...t,children:[],component:new xe(n,t.props||{},t.children,e,t.$__neep__delivered)};if(n===m){var r;const n=null==t||null===(r=t.props)||void 0===r?void 0:r.type,o=n?a(n):e.iRender;return{...t,children:[],component:new He(o,t.props||{},t.children,e,t.$__neep__delivered)}}return n===_?{...t,children:[]}:(n===g||n.substr(0,5),{...t,children:Ce(e,t.children)})}function $e(e,t,n){Array.isArray(n)||(n=[n]);const r=[];for(const o of J(t)){const t=Re(o);if(!t)continue;const i=n.findIndex(e=>e.tag===t.tag&&e.key===t.key);i>=0?(r.push(Se(e,t,n[i])),n.splice(i,1)):r.push(ke(e,t))}return Ae(n),r}function Se(e,t,n){if(!n)return ke(e,t);if(!t)return Ae(n),{tag:null,children:[]};if(Array.isArray(n)){if(!n.length)return ke(e,t);const r=n.findIndex(e=>e.tag===t.tag);if(r<0)return Ae(n),ke(e,t);const o=n;[n]=n.splice(r,1),Ae(o)}const{tag:r}=t;if(r!==n.tag)return Ae(n),ke(e,t);if(!r)return{tag:null,children:[]};if("string"!=typeof r){if("simple"===r[E])return{...t,children:Ce(e,t.children,n.children),component:void 0};const{component:o}=n;return o?(o.update(t.props||{},t.children),{...t,children:[],component:o}):ke(e,t)}if(r===m){var o;const{component:r}=n;if(!r)return ke(e,t);const i=null==t||null===(o=t.props)||void 0===o?void 0:o.type;return(i?a(i):e.iRender)!==r.iRender?ke(e,t):(r.update(t.props||{},t.children),{...t,children:[],component:r})}if(r===_)return{...t,children:[]};if(r===g||"Neep:"===r.substr(0,5)){let o;if(v===r){const e={...t.props};delete e.ref,delete e.slot,delete e.key,o=he(n.$__neep__delivered,e,n.props,!0)}return{...t,$__neep__delivered:o,children:Ce(e,t.children,n.children)}}return{...t,children:Ce(e,t.children,n.children)}}function*De(e,t,n){let r=0,o=Math.min(t.length,t.length);for(;r<o;r++){const o=t[r];Array.isArray(o)?yield $e(e,o,n[r]):yield Se(e,Re(o),n[r])}if(o=Math.max(t.length,t.length),n.length>o)for(;r<o;r++)Ae(n[r]);if(t.length>o)for(;r<o;r++){const n=Re(t[r]);Array.isArray(n)?yield[...J(n)].map(t=>ke(e,t)):yield ke(e,n)}}function Ce(e,t,n){return Array.isArray(t)||(t=[t]),n?[...De(e,t,n)]:function(e,t){return t.length?t.map(t=>Array.isArray(t)?[...J(t)].map(t=>ke(e,Re(t))):ke(e,Re(t))):[]}(e,t)}let Ne=new Set,je=!1;class He extends be{constructor(e,t,n,r,i){super(e,r,i),o(this,"props",void 0),o(this,"content",[]),o(this,"_node",null),o(this,"_container",null),o(this,"rootContainer",this),o(this,"_drawChildren",!1),o(this,"_drawContainer",!1),o(this,"_awaitDraw",new Set),o(this,"_needDraw",!1),o(this,"_containers",new Set),this.props=t,this.parent=r,r&&(this.rootContainer=r.container.rootContainer),this.callHook("beforeCreate"),this._render=()=>n,this._nodes=Ce(this,n),this.callHook("created"),this.created=!0}setChildren(e){this.destroyed||(this.childNodes=e,this._render=()=>e,this._drawChildren=!0,this.refresh())}setProps(e){this.destroyed||(this.props=e,this._drawContainer=!0,this.refresh())}update(e,t){this.refresh(()=>{this.setProps(e),this.setChildren(t)})}_refresh(){this.markDraw(this)}_mount(){const{props:t,parent:n,iRender:r}=this,o=ce(this.container.iRender,this._nodes);this.content=o;const[i,s]=r.mount(t,e.isValue,null==n?void 0:n.iRender);for(const e of W(o))r.insert(i,e);this.tree=[G({tag:_,component:void 0,node:s,value:s,children:[]})],this._node=s,this._container=i}_destroy(){Ae(this.content)}_unmount(){const{parent:e,iRender:t}=this;e&&X(e.iRender,this.tree),t.unmount(this._container,this._node,Boolean(e)),X(this.iRender,this.content)}_draw(){}_drawSelf(){const{_drawChildren:t,_drawContainer:n}=this;var r;(this._needDraw=!1,this._drawChildren=!1,this._drawContainer=!1,this.callHook("beforeUpdate"),n)&&this.iRender.drawContainer(this._container,this._node,this.props,e.isValue,null===(r=this.parent)||void 0===r?void 0:r.iRender);t&&(this.content=ce(this.iRender,this._nodes,this.content)),this.callHook("updated")}drawSelf(){this.mounted&&(this.destroyed||s.exec(()=>this._drawSelf,()=>this.markDraw(this),{postpone:!0}))}markDraw(e,t=!1){e===this?this._needDraw=!t:t?this._awaitDraw.delete(e):this._awaitDraw.add(e),this.rootContainer.markDrawContainer(this,!this._needDraw&&!this._awaitDraw.size||this.destroyed)}drawContainer(){const{_node:e,_container:t,_awaitDraw:n}=this;if(!e||!t)return;this.callHook("beforeDraw");const r=this._needDraw;this._needDraw=!1;const o=[...n];n.clear(),r&&this.drawSelf(),o.map(e=>e.draw()),this.iRender.draw(t,e),this.callHook("drawn")}markDrawContainer(e,t=!1){var n;t?this._containers.delete(e):this._containers.add(e),n=this,Ne.add(n),je||(je=!0,l(()=>{je=!1;const e=[...Ne];Ne.clear(),e.map(e=>e.drawAll())}))}drawAll(){const e=this._containers;e.size&&(this.callHook("beforeDrawAll"),[...e].map(e=>e.drawContainer()),this.callHook("drawnAll"))}}function Oe(e,t){return n=>(n[e]=t,n)}h({monitorable:t}),e.Container=m,e.Deliver=v,e.Error=i,e.Fragment=b,e.ScopeSlot=f,e.Slot=y,e.SlotRender=p,e.Tags=w,e.Template=g,e.Value=_,e.addContextConstructor=function(e){A.push(s.safeify(e))},e.callHook=D,e.checkCurrent=R,e.create=function(e,t){return"function"==typeof t&&(e[I]=t),e},e.createElement=F,e.defineAuxiliary=function(e,t){Reflect.defineProperty(q,e,{get:t,enumerable:!0,configurable:!0})},e.deliver=V,e.elements=K,e.expose=O,e.hook=j,e.install=h,e.isElement=M,e.isElementSymbol=T,e.isProduction=!0,e.label=U,e.mName=function(e,t){return t?(t[z]=e,t):Oe(z,e)},e.mNative=function(e){return e?(e[E]="native",e):Oe(E,"native")},e.mRender=function(e,t){return t?(t[I]=e,t):Oe(I,e)},e.mSimple=function(e){return e?(e[E]="simple",e):Oe(E,"simple")},e.mType=function(e,t){return t?(t[E]=e,t):Oe(E,e)},e.mark=function(e,...t){for(const n of t)n(e);return e},e.mode=n,e.nameSymbol=z,e.refresh=function(e,t){if(t)return async function(e){try{return _e++,await e()}finally{_e--,ge()}}(e);try{return _e++,e()}finally{_e--,ge()}},e.render=function(e,t={}){let n={...t};const r=new He(a(t.type),n,void 0===e?[]:M(e)?[e]:[F(e)]),{exposed:o}=r;return Reflect.defineProperty(o,"$update",{value:e=>(r.setChildren(void 0===e?[]:M(e)?[e]:[F(e)]),o),configurable:!0}),Reflect.defineProperty(o,"$mount",{value:e=>(o.$mounted||(e&&(n.target=e,r.setProps(n)),r.mount()),o),configurable:!0}),Reflect.defineProperty(o,"$unmount",{value(){if(o.$mounted&&!o.$unmounted)return o.$destroyed?r.destroy():void r.unmount()},configurable:!0}),n.target&&r.mount(),o},e.renderSymbol=I,e.setAuxiliary=function(e,t){Reflect.defineProperty(q,e,{value:t,enumerable:!0,configurable:!0})},e.setHook=S,e.setValue=H,e.typeSymbol=E,e.useValue=N,e.version="undefined",e.watch=C,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=neep.core.min.js.map
