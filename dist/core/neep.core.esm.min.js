/*!
 * neep v0.1.0-alpha.1
 * (c) 2019-2020 Fierflame
 * @license MIT
 */
const e="0.1.0-alpha.1",t="production",n=!0;var r=Object.freeze({__proto__:null,version:"0.1.0-alpha.1",mode:t,isProduction:!0});let o;const i=Object.create(null);function s(e=""){return"object"==typeof e?e:i[e]||i.default}function c(e){e.monitorable&&(o=e.monitorable),function({render:e,renders:t}){if(e&&(i[e.type]=e,i.default||(i.default=e)),Array.isArray(t)){for(const e of t)i[e.type]=e;if(!i.default){const[e]=t;e&&(i.default=e)}}}(e)}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class l extends Error{constructor(e,t=""){super(t?`[${t}] ${e}`:e),d(this,"tag",void 0),this.tag=t}}const u="Neep:ScopeSlot",a="Neep:SlotRender",h="Neep:Slot",f="Neep:Value",p="Neep:Container",_="Neep:Deliver",y="template",m=y;var g=Object.freeze({__proto__:null,ScopeSlot:u,SlotRender:a,Slot:h,Value:f,Container:p,Deliver:_,Template:y,Fragment:m});function v(...e){return o.value(...e)}function b(...e){return o.computed(...e)}function w(...e){return o.isValue(...e)}function R(...e){return o.encase(...e)}function x(...e){return o.recover(...e)}var A=Object.freeze({__proto__:null,value:v,computed:b,isValue:w,encase:R,recover:x});let k;function $(e,t){const n=k;k=t;try{k.$_valueIndex=0;const t=e();if(k.$_valueIndex!==k.$_values.length)throw new l("Inconsistent number of useValue executions","life");return t}finally{k=n}}function C(e,t=!1){if(!k)throw new l(`Function \`${e}\` can only be called within a cycle.`,"life");if(!t)return k;if(!k.created)return k;throw new l(`Function \`${e}\` can only be called at initialization time.`,"life")}const D=[];function j(e,t){for(const n of D)n(e,t);return e}function S(e){D.push(o.safeify(e))}const N=Object.create(null);function H(e,t,n){let r=(null==n?void 0:n.$_hooks)||N;if(!r)return()=>{};t=o.safeify(t);let i=r[e];return i||(i=new Set,r[e]=i),i.add(t),()=>i.delete(t)}function O(e,t){if(t){for(const n of t.$_hooks[e]||[])n(t);for(const n of N[e]||[])n(t)}}function P(e,t){const n=C("watch");if("function"!=typeof e)return()=>{};const r=w(e)?e.watch(t):o.computed(e).watch((e,n)=>t(e(),n));return H("beforeDestroy",()=>r(),n),r}function z(e,t="useValue"){const n=C(t),r=n.$_valueIndex++,o=n.$_values;if(!n.created)return o[r]=void 0,o[r]=e();if(r>=o.length)throw new l("Inconsistent number of useValue executions","life");return o[r]}function I(e,t,n){const r=C("setHook");if(!n||!r.created)return H(e,()=>t(),r)}function E(e,t,n,r){"string"==typeof t&&["$","_"].includes(t[0])||(w(n)&&r?Reflect.defineProperty(e,t,{get:()=>n(),set(e){n(e)},configurable:!0,enumerable:!0}):"function"==typeof n&&r?Reflect.defineProperty(e,t,{get:n,set:"function"==typeof r?r:void 0,configurable:!0,enumerable:!0}):Reflect.defineProperty(e,t,{get:()=>n,configurable:!0,enumerable:!0}))}function V(e,t,n){E(C("expose",!0).exposed,e,t,n)}function M(e,t,n){E(C("deliver",!0).delivered,e,t,n)}var K=Object.freeze({__proto__:null,watch:P,useValue:z,hook:I,setValue:E,expose:V,deliver:M});const F=Symbol.for("isNeepElement"),B=Symbol.for("type"),U=Symbol.for("name"),Z=Symbol.for("render");function T(e){return!!e&&("object"==typeof e&&!0===e[F])}function q(e,t,...n){t=t?{...t}:{};const r={[F]:!0,tag:e,children:[]};if("key"in t&&(r.key=t.key),"slot"in t&&(r.slot=t.slot),"function"==typeof t.ref&&(r.ref=t.ref),e===f)return r.value=t.value,r;if(r.children=n,e===y)return r;if(e===a)return r.render=t.render,r;if(e===u||e===h){const{render:n,argv:o,args:i,name:s}=t;if(r.render=n,r.args=o&&[o]||Array.isArray(i)&&i.length&&i||[{}],e===u)return r.props={name:s},r}r.on={},r.props={};for(let e in t){const n=/^(::|@|on:)([a-zA-Z0-9].*)$/.exec(e);n?r.on[n[2]]=t[e]:/^n([:-])([a-zA-Z0-9]+(?:\.[a-zA-Z0-9]+)*)$/i.exec(e)||(r.props[e]=t[e])}return r}function G(e,t={}){if(Array.isArray(e)){const n=[];for(let r of e)n.push(G(r,t));return[].concat(...n)}if(!T(e))return[e];let{tag:n}=e;if(!n)return[];if([y,u].includes(n))return G(e.children,t);if("function"!=typeof n)return[e];if("simple"!==n[B])return[e];const{simple:r}=t;if(!r)return[e];if(Array.isArray(r)){if(r.includes(n))return[e]}else if("function"==typeof r&&!r(n))return[e];return G(e.children,t)}var J=Object.freeze({__proto__:null,isElement:T,createElement:q,elements:G});function L(e,t=""){}var Q=Object.freeze({__proto__:null,label:L});const W={...g,...A,...K,...J,...Q,...r};function X(e,t){Reflect.defineProperty(W,e,{value:t,enumerable:!0,configurable:!0})}function Y(e,t){Reflect.defineProperty(W,e,{get:t,enumerable:!0,configurable:!0})}function ee(e,t){return{...e,id:0}}function*te(e){if(Array.isArray(e))for(const t of e)yield*te(t);else yield e}function ne(e){if(Array.isArray(e))return ne(e[e.length-1]);const{component:t,children:n,node:r}=e;return r||ne(t?t.tree:n)}function re(e){if(Array.isArray(e))return re(e[0]);const{component:t,children:n,node:r}=e;return r||re(t?t.tree:n[0])}function*oe(e){if(Array.isArray(e)){for(const t of e)yield*oe(t);return}const{children:t,node:n,component:r}=e;n?yield n:r?yield*oe(r.tree):yield*oe(t)}function ie(e,t){if(Array.isArray(t))return void t.forEach(t=>ie(e,t));const{component:n,children:r,node:o,ref:i}=t;return o?(i&&i(o,!0),void e.remove(o)):n?(i&&i(n.exposed,!0),void n.unmount()):void ie(e,r)}function se(e,t,n){const r=re(n);if(!r)return t;const o=e.parent(r);if(!o)return t;for(const n of oe(t))e.insert(o,n,r);return ie(e,n),t}function ce(e,t,n){if(!t.length){return[se(e,fe(e,{tag:null,children:[]}),n)]}Array.isArray(n)||(n=[n]);const r=[],o=[...n],i=new Map;for(const n of t){const t=o.findIndex(e=>e.tag===n.tag&&e.key===n.key);if(t>=0){const s=o[t],c=le(e,n,s);i.set(s,c),r.push(c),o.splice(t,1)}else{const t=fe(e,n);r.push(t)}}if(!i.size)return se(e,r,o);ie(e,o);const s=ne((n=n.filter(e=>i.has(e)))[n.length-1]),c=e.parent(s);if(!c)return r;let d=e.next(s);for(let t=r.length-1;t>=0;t--){const o=r[t],s=n.findIndex(e=>i.get(e)===o);if(s>=0)for(const e of n.splice(s))i.delete(e);else for(const t of oe(o))e.insert(c,t,d);d=re(o)||d}return r}function de(e,t,n){let r=0,o=Math.min(t.length,t.length||1);const i=[];for(;r<o;r++){const o=t[r];Array.isArray(o)?i.push(ce(e,o,n[r])):i.push(le(e,o,n[r]))}if(o=Math.max(t.length,n.length),n.length>o)for(;r<o;r++)ie(e,n[r]);if(t.length>o){const n=ne(i[i.length-1]),s=e.parent(n),c=e.next(n);for(;r<o;r++){const n=t[r],o=Array.isArray(n)?he(e,n):fe(e,n);if(i.push(o),s)for(const t of oe(o))e.insert(s,t,c)}}return i}function le(e,t,n){if(Array.isArray(n)){const r=n.findIndex(e=>e.tag===t.tag&&e.component===t.component);if(r<0)return se(e,fe(e,t),n);const o=n;[n]=n.splice(r,1),ie(e,o)}const{tag:r,component:o}=t,i=t.ref!==n.ref&&t.ref;if(r!==n.tag||o!==n.component)return se(e,fe(e,t),n);if(!r)return n;if("string"!=typeof r||r===p)return o?(i&&i(o.exposed),ee({...t,node:void 0,component:o,children:[]},n.id)):ee({...t,node:void 0,component:void 0,children:pe(e,t.children,n.children)},n.id);if(r===f)return n.value===t.value?(i&&n.node&&i(n.node),ee({...n,...t,children:[]},n.id)):se(e,ue(e,t),n);if(r===y||"Neep:"===r.substr(0,5))return ee({...t,node:void 0,component:void 0,children:de(e,t.children,n.children)},n.id);const{node:s}=n;if(e.update(s,t.props||{}),i&&i(s),!t.children.length&&!n.children.length)return ee({...n,...t,children:[]},n.id);if(!t.children.length&&n.children.length&&ie(e,n.children),t.children.length&&!n.children.length){const r=ae(e,t.children);for(const t of oe(r))e.insert(s,t);return ee({...n,...t,children:r},n.id)}return ee({...n,...t,children:de(e,t.children,n.children)},n.id)}function ue(e,t){const{value:n,ref:r}=t;if(e.isNode(t.value))return r&&r(n),ee({...t,node:n,children:[],component:void 0});const o=typeof n;let i;return"bigint"===o||"boolean"===o||"number"===o||"string"===o||"symbol"===o||n instanceof RegExp?i=e.text(String(n)):n instanceof Date?i=e.text(n.toISOString()):"object"===o&&n&&(i=e.text(String(n))),i||(i=e.placeholder()),r&&r(i),ee({...t,node:i,component:void 0,children:[]})}function ae(e,t){return t.length?t.map(t=>Array.isArray(t)?he(e,t):fe(e,t)):[ee({tag:null,node:e.placeholder(),component:void 0,children:[]})]}function he(e,t){return t.length?t.map(t=>fe(e,t)):[ee({tag:null,node:e.placeholder(),component:void 0,children:[]})]}function fe(e,t){const{tag:n,ref:r,component:o}=t;if(!n){const t=e.placeholder();return r&&r(t),ee({tag:null,node:t,component:void 0,children:[]})}if("string"!=typeof n||n===p)return o?(o.mount(),r&&r(o.exposed),ee({...t,node:void 0,component:o,children:[]})):ee({...t,node:void 0,component:void 0,children:pe(e,t.children)});if(n===f)return ue(e,t);if(n===y||"Neep:"===n.substr(0,5))return ee({...t,node:void 0,component:void 0,children:ae(e,t.children)});const i=e.create(n,t.props||{});r&&r(i);let s=[];if(t.children){s=ae(e,t.children);for(const t of oe(s))e.insert(i,t)}return ee({...t,node:i,component:void 0,children:s})}function pe(e,t,n){return n?de(e,t,n):ae(e,t)}function _e(e,t,n,r=!1){const o=[];for(const i of t){if(Array.isArray(i)){const t=Object.create(null);o.push(_e(e,i,t,r));for(const e of Reflect.ownKeys(t))e in n?n[e].push(t[e]):n[e]=[t[e]];continue}if(r){if(e.isNode(i)){o.push(i);continue}if(!T(i)){o.push(i);continue}if(i.tag!==a){o.push(i);continue}}const t=T(i)&&i.slot||"default",s=T(i)?{...i,slot:void 0,props:{...i.props,slot:void 0}}:i;t in n?n[t].push(s):n[t]=[s]}return o}function ye(e,...t){return e.map(e=>Array.isArray(e)?ye(e,...t):T(e)?e.tag!==a?{...e,slot:void 0}:"function"==typeof e.render?e.render(...t):e.children:e)}function me(e,t){const n=(...e)=>({[F]:!0,tag:u,children:ye(t,...e),inserted:!0,label:void 0});return n.children=t,n}function ge(e,t=Object.create(null)){for(const n of Reflect.ownKeys(t))n in e||delete t[n];for(const n of Reflect.ownKeys(e))t[n]=me(0,e[n]);return t}function ve(e,t,n={},r=!1){const o=new Set(Reflect.ownKeys(t));for(const t of Reflect.ownKeys(e))o.has(t)||delete e[t];if(!r){for(const n of o)e[n]=t[n];return e}for(const r of o){const o=t[r];r in n&&n[r]===o||(w(o)?Reflect.defineProperty(e,r,{configurable:!0,enumerable:!0,get:()=>o(),set(e){o(e)}}):Reflect.defineProperty(e,r,{configurable:!0,enumerable:!0,value:o}))}return e}function be(e,t,n,r,o=!1){if(Array.isArray(n))return n.map(n=>be(e,t,n,r,o));if(!T(n))return n;let{tag:i,inserted:s,args:c=[{}]}=n;if(i===_){const s={...n.props};delete s.ref,delete s.slot,delete s.key;const c=Object.create(t);return ve(c,s||{},{},!0),{...n,tag:i,$__neep__delivered:c,children:n.children.map(t=>be(e,c,t,r,o))}}const d=n.children.map(n=>be(e,t,n,r,o));return"function"==typeof i?"simple"===i[B]?function(e,t,n,r,o){const{iRender:i}=e.container,s=Object.create(null);_e(i,o,s);const c=ge(s),d=j({slots:c,created:!1,parent:e.exposed,delivered:t,children:new Set,childNodes:o,refresh(t){e.refresh(t)}}),l=r({...n.props},d,W),u=be(e,t,we(i,l,d,r[Z]),c);return{...n,children:Array.isArray(u)?u:[u],label:void 0}}(e,t,n,i,d):{...n,$__neep__delivered:t,children:d,tag:i}:(i===h&&(i=o?"slot":u),i!==u||s?{...n,children:d,tag:i}:function(e,t,n,r=[{}]){var o;const i=t[(null===(o=e.props)||void 0===o?void 0:o.name)||"default"];if("function"==typeof i)return{...e,...i(...r)};const{render:s}=e;return{...e,tag:u,label:void 0,children:"function"!=typeof s?n:s(...r)}}(n,r,d,c))}function we(e,t,n,r){return Array.isArray(t)?t:T(t)?[t]:null==t?[{[F]:!0,tag:null,children:[]}]:(!e.isNode(t)&&"object"==typeof t&&r&&(t=r(t,n,W)),T(t)?[t]:null==t?[{[F]:!0,tag:null,children:[]}]:[{[F]:!0,tag:f,value:t,children:[]}])}function Re(e,t){return be(e,e.delivered,we(e.iRender,t,e.context,e.component[Z]),e.context.slots,Boolean(e.native))}class xe{constructor(e,t,n=(null==t?void 0:t.delivered)||Object.create(null),r){d(this,"iRender",void 0),d(this,"parentDelivered",void 0),d(this,"delivered",void 0),d(this,"exposed",function(e){const t={$parent:{configurable:!0,get:()=>{var t;return null===(t=e.parent)||void 0===t?void 0:t.exposed}},$component:{configurable:!0,value:null},$isContainer:{configurable:!0,value:!1},$created:{configurable:!0,get:()=>e.created},$destroyed:{configurable:!0,get:()=>e.destroyed},$mounted:{configurable:!0,get:()=>e.mounted},$unmounted:{configurable:!0,get:()=>e.unmounted}};return Object.create(null,t)}(this)),d(this,"entity",function(e){const t={exposed:{configurable:!0,get:()=>e.exposed},delivered:{configurable:!0,get:()=>e.delivered},parent:{configurable:!0,get:()=>{var t;return null===(t=e.parent)||void 0===t?void 0:t.entity}},component:{configurable:!0,value:null},isContainer:{configurable:!0,value:!1},created:{configurable:!0,get:()=>e.created},destroyed:{configurable:!0,get:()=>e.destroyed},mounted:{configurable:!0,get:()=>e.mounted},unmounted:{configurable:!0,get:()=>e.unmounted},$_hooks:{configurable:!0,value:Object.create(null)},$_valueIndex:{configurable:!0,value:0,writable:!0},$_values:{configurable:!0,value:[]},callHook:{configurable:!0,value(e){O(e,n)}},setHook:{configurable:!0,value:(e,t)=>H(e,t,n)},refresh:{configurable:!0,value(t){e.refresh(t)}}},n=Object.create(null,t);return n}(this)),d(this,"parent",void 0),d(this,"native",null),d(this,"created",!1),d(this,"destroyed",!1),d(this,"mounted",!1),d(this,"unmounted",!1),d(this,"children",new Set),d(this,"tree",[]),d(this,"container",void 0),d(this,"_render",()=>[]),d(this,"_needRefresh",!1),d(this,"_delayedRefresh",0),d(this,"_refreshing",!1),d(this,"_nodes",[]),d(this,"childNodes",[]),d(this,"__executed_destroy",!1),d(this,"__executed_mount",!1),d(this,"__executed_mounted",!1),this.iRender=e,this.parentDelivered=n,this.delivered=Object.create(n),t&&(this.parent=t),this.container=r||this}get canRefresh(){return!this._delayedRefresh}get needRefresh(){if(this._delayedRefresh)return!1;const e=this._needRefresh;return this._needRefresh=!1,e}_refresh(){}refresh(e){if("function"==typeof e){try{this._delayedRefresh++,e()}finally{this._delayedRefresh--,this._delayedRefresh<=0&&this.refresh()}return}if(this.destroyed)return;if(!this.created)return;if(this._needRefresh=!0,this._refreshing)return;let t;for(this._refreshing=!0;this.needRefresh;)if(t=this._render(),this.destroyed)return;this._refreshing=!1,this.canRefresh&&t&&(this._nodes=He(this,t,this._nodes),this.mounted&&(this.destroyed||this.unmounted||this._refresh()))}callHook(e){O(e,this.entity)}_update(e,t){this.childNodes=t}update(e,t){this._update(e,t)}_destroy(){}destroy(){this.__executed_destroy||(this.__executed_destroy=!0,this.callHook("beforeDestroy"),this._destroy(),this.callHook("destroyed"),this.destroyed=!0)}_mount(){}mount(){this.__executed_destroy||this.__executed_mount||(this.__executed_mount=!0,this.callHook("beforeMount"),this._mount(),this.callHook("mounted"),this.mounted=!0)}_unmount(){}unmount(){this.mounted&&(this.__executed_mounted||(this.__executed_mounted=!0,this.callHook("beforeUnmount"),this._unmount(),this.callHook("unmounted"),this.unmounted=!0))}_draw(){}draw(){this.__executed_destroy||(this.callHook("beforeUpdate"),this._draw(),this.callHook("updated"))}}function Ae(e,t,n){ve(e.props,t);const r=Object.create(null),{native:o,container:{iRender:i}}=e,s=_e(i,n,r,Boolean(o));ge(r,e.slots),o&&(e.nativeNodes=He(e,s,e.nativeNodes))}class ke extends xe{constructor(e,t,n,r,i){super(r.iRender,r,i,r.container),d(this,"component",void 0),d(this,"props",o.encase(Object.create(null))),d(this,"slots",o.encase(Object.create(null))),d(this,"_stopRender",void 0),d(this,"nativeNodes",void 0),d(this,"nativeTree",[]),d(this,"context",void 0),d(this,"parent",void 0),this.component=e,Reflect.defineProperty(this.exposed,"$component",{value:e,enumerable:!0,configurable:!0}),this.parent=r,r.children.add(this.exposed);const s=j({slots:(c=this).slots,get created(){return c.created},get parent(){return c.parent.exposed},get delivered(){return c.parentDelivered},get children(){return c.children},get childNodes(){return c.childNodes},refresh(e){c.refresh(e)}},c.exposed);var c;this.context=s,this.callHook("beforeCreate"),this.childNodes=n,Ae(this,t,n);const{render:l,nodes:u,stopRender:a}=function(e){const{component:t,props:n,context:r,entity:i}=e,s=t=>t&&e.refresh(),c=o.exec(()=>$(()=>t(n,r,W),i),s,!0);if("function"==typeof c){const t=o.createExecutable(()=>Re(e,c()),s);return{nodes:t(),render:t,stopRender:()=>t.stop()}}const d=o.createExecutable(()=>Re(e,$(()=>t(n,r,W),i)),s);return{nodes:o.exec(()=>Re(e,c),s,!0),render:d,stopRender:()=>d.stop()}}(this);this._render=l,this._stopRender=a,this._nodes=He(this,u),this.callHook("created"),this.created=!0,this._needRefresh&&this.refresh()}_update(e,t){this.destroyed||(this.childNodes=t,Ae(this,e,t))}_destroy(){this._stopRender&&this._stopRender(),this.parent.children.delete(this.exposed),Ce(this._nodes)}_refresh(){this.container.markDraw(this)}_draw(){this.tree=pe(this.container.iRender,this._nodes,this.tree)}_mount(){this.tree=pe(this.container.iRender,this._nodes)}_unmount(){ie(this.container.iRender,this.tree)}}function $e(e){return!1===e||null==e?null:T(e)?e:{[F]:!0,tag:f,key:e,value:e,children:[]}}function Ce(e){if(Array.isArray(e))return void e.forEach(e=>Ce(e));const{component:t}=e;t&&t.destroy()}function De(e,t){if(!t)return{tag:null,children:[]};const{tag:n}=t;if(!n)return{tag:null,children:[]};if("string"!=typeof n)return"simple"===n[B]?{...t,children:He(e,t.children),component:void 0}:{...t,children:[],component:new ke(n,t.props||{},t.children,e,t.$__neep__delivered)};if(n===p){var r;const n=null==t||null===(r=t.props)||void 0===r?void 0:r.type,o=n?s(n):e.iRender;return{...t,children:[],component:new ze(o,t.props||{},t.children,e,t.$__neep__delivered)}}return n===f?{...t,children:[]}:(n===y||n.substr(0,5),{...t,children:He(e,t.children)})}function je(e,t,n){Array.isArray(n)||(n=[n]);const r=[];for(const o of te(t)){const t=$e(o);if(!t)continue;const i=n.findIndex(e=>e.tag===t.tag&&e.key===t.key);i>=0?(r.push(Se(e,t,n[i])),n.splice(i,1)):r.push(De(e,t))}return Ce(n),r}function Se(e,t,n){if(!n)return De(e,t);if(!t)return Ce(n),{tag:null,children:[]};if(Array.isArray(n)){if(!n.length)return De(e,t);const r=n.findIndex(e=>e.tag===t.tag);if(r<0)return Ce(n),De(e,t);const o=n;[n]=n.splice(r,1),Ce(o)}const{tag:r}=t;if(r!==n.tag)return Ce(n),De(e,t);if(!r)return{tag:null,children:[]};if("string"!=typeof r){if("simple"===r[B])return{...t,children:He(e,t.children,n.children),component:void 0};const{component:o}=n;return o?(o.update(t.props||{},t.children),{...t,children:[],component:o}):De(e,t)}if(r===p){var o;const{component:r}=n;if(!r)return De(e,t);const i=null==t||null===(o=t.props)||void 0===o?void 0:o.type;return(i?s(i):e.iRender)!==r.iRender?De(e,t):(r.update(t.props||{},t.children),{...t,children:[],component:r})}if(r===f)return{...t,children:[]};if(r===y||"Neep:"===r.substr(0,5)){let o;if(_===r){const e={...t.props};delete e.ref,delete e.slot,delete e.key,o=ve(n.$__neep__delivered,e,n.props,!0)}return{...t,$__neep__delivered:o,children:He(e,t.children,n.children)}}return{...t,children:He(e,t.children,n.children)}}function*Ne(e,t,n){let r=0,o=Math.min(t.length,t.length);for(;r<o;r++){const o=t[r];Array.isArray(o)?yield je(e,o,n[r]):yield Se(e,$e(o),n[r])}if(o=Math.max(t.length,t.length),n.length>o)for(;r<o;r++)Ce(n[r]);if(t.length>o)for(;r<o;r++){const n=t[r];Array.isArray(n)?yield[...te(n)].map(t=>De(e,t)):yield De(e,n)}}function He(e,t,n){return Array.isArray(t)||(t=[]),n?[...Ne(e,t,n)]:function(e,t){return t.length?t.map(t=>Array.isArray(t)?[...te(t)].map(t=>De(e,$e(t))):De(e,$e(t))):[]}(e,t)}let Oe=new Set,Pe=!1;class ze extends xe{constructor(e,t,n,r,o){super(e,r,o),d(this,"props",void 0),d(this,"content",[]),d(this,"_node",null),d(this,"_container",null),d(this,"rootContainer",this),d(this,"_drawChildren",!1),d(this,"_drawContainer",!1),d(this,"_awaitDraw",new Set),d(this,"_needDraw",!1),d(this,"_containers",new Set),this.props=t,this.parent=r,r&&(this.rootContainer=r.container.rootContainer),this.callHook("beforeCreate"),this._render=()=>n,this._nodes=He(this,n),this.callHook("created"),this.created=!0}setChildren(e){this.destroyed||(this.childNodes=e,this._render=()=>e,this._drawChildren=!0,this.refresh())}setProps(e){this.destroyed||(this.props=e,this._drawContainer=!0,this.refresh())}update(e,t){this.refresh(()=>{this.setProps(e),this.setChildren(t)})}_refresh(){this.markDraw(this)}_mount(){const{props:e,parent:t,iRender:n}=this,r=pe(this.container.iRender,this._nodes);this.content=r;const[o,i]=n.mount(e,null==t?void 0:t.iRender);for(const e of oe(r))n.insert(o,e);this.tree=[ee({tag:f,component:void 0,node:i,value:i,children:[]})],this._node=i,this._container=o}_destroy(){Ce(this.content)}_unmount(){const{parent:e,iRender:t}=this;e&&ie(e.iRender,this.tree),t.unmount(this._container,this._node,Boolean(e)),ie(this.iRender,this.content)}_draw(){}drawSelf(){if(!this.mounted)return;if(this.destroyed)return;const{_drawChildren:e,_drawContainer:t}=this;var n;(this._needDraw=!1,this._drawChildren=!1,this._drawContainer=!1,this.callHook("beforeUpdate"),t)&&this.iRender.drawContainer(this._container,this._node,this.props,null===(n=this.parent)||void 0===n?void 0:n.iRender);e&&(this.content=pe(this.iRender,this._nodes,this.content)),this.callHook("updated")}markDraw(e,t=!1){e===this?this._needDraw=!t:t?this._awaitDraw.delete(e):this._awaitDraw.add(e),this.rootContainer.markDrawContainer(this,!this._needDraw&&!this._awaitDraw.size||this.destroyed)}drawContainer(){const{_node:e,_container:t,_awaitDraw:n}=this;if(!e||!t)return;this.callHook("beforeDraw");const r=this._needDraw;this._needDraw=!1;const o=[...n];n.clear(),r&&this.drawSelf(),o.map(e=>e.draw()),this.iRender.draw(t,e),this.callHook("drawn")}markDrawContainer(e,t=!1){var n;t?this._containers.delete(e):this._containers.add(e),n=this,Oe.add(n),Pe||(Pe=!0,window.requestAnimationFrame(()=>{Pe=!1;const e=[...Oe];Oe.clear(),e.map(e=>e.drawAll())}))}drawAll(){const e=this._containers;e.size&&(this.callHook("beforeDrawAll"),[...e].map(e=>e.drawContainer()),this.callHook("drawnAll"))}}function Ie(e,t={}){let n={...t};const r=new ze(s(t.type),n,void 0===e?[]:T(e)?[e]:[q(e)]),{exposed:o}=r;return Reflect.defineProperty(o,"$update",{value:e=>(r.setChildren(void 0===e?[]:T(e)?[e]:[q(e)]),o),configurable:!0}),Reflect.defineProperty(o,"$mount",{value:e=>(o.$mounted||(e&&(n.target=e,r.setProps(n)),r.mount()),o),configurable:!0}),Reflect.defineProperty(o,"$unmount",{value(){if(o.$mounted&&!o.$unmounted)return o.$destroyed?r.destroy():void r.unmount()},configurable:!0}),n.target&&r.mount(),o}function Ee(e,t){return n=>(n[e]=t,n)}function Ve(e,t){return t?(t[U]=e,t):Ee(U,e)}function Me(e,t){return t?(t[B]=e,t):Ee(B,e)}function Ke(e){return e?(e[B]="simple",e):Ee(B,"simple")}function Fe(e){return e?(e[B]="native",e):Ee(B,"native")}function Be(e,t){return t?(t[Z]=e,t):Ee(Z,e)}function Ue(e,t){return"function"==typeof t&&(e[Z]=t),e}function Ze(e,...t){for(const n of t)n(e);return e}export{p as Container,_ as Deliver,l as Error,m as Fragment,u as ScopeSlot,h as Slot,a as SlotRender,g as Tags,y as Template,f as Value,S as addContextConstructor,O as callHook,C as checkCurrent,b as computed,Ue as create,q as createElement,k as current,Y as defineAuxiliary,M as deliver,G as elements,R as encase,V as expose,I as hook,c as install,T as isElement,F as isElementSymbol,n as isProduction,w as isValue,L as label,Ve as mName,Fe as mNative,Be as mRender,Ke as mSimple,Me as mType,Ze as mark,t as mode,U as nameSymbol,x as recover,Ie as render,Z as renderSymbol,X as setAuxiliary,H as setHook,E as setValue,B as typeSymbol,z as useValue,v as value,e as version,P as watch};
//# sourceMappingURL=neep.core.esm.min.js.map
